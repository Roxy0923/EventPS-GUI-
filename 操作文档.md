# EventPS CNN-PS å®Œæ•´æ“ä½œæ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [å¿«é€Ÿå‚è€ƒ](#å¿«é€Ÿå‚è€ƒ) â­ **æœ€å¸¸ç”¨å‘½ä»¤**
2. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
3. [ä»æºä»£ç æ„å»º](#ä»æºä»£ç æ„å»º) ğŸ”§ **æ–°å¢**
4. [æ•°æ®å‡†å¤‡](#æ•°æ®å‡†å¤‡) ğŸ“¦ **æ–°å¢**
5. [å¯æ‰§è¡Œæ–‡ä»¶è¯´æ˜](#å¯æ‰§è¡Œæ–‡ä»¶è¯´æ˜)
6. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
7. [GUIæ˜¾ç¤ºæ¨¡å¼](#guiæ˜¾ç¤ºæ¨¡å¼)
8. [è¯„ä¼°æ“ä½œ](#è¯„ä¼°æ“ä½œ)
9. [è®­ç»ƒæ“ä½œ](#è®­ç»ƒæ“ä½œ)
10. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
11. [è¯„ä¼°ç»“æœ](#è¯„ä¼°ç»“æœ)

---

## å¿«é€Ÿå‚è€ƒ

### ğŸ”§ æ„å»ºé¡¹ç›®ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰

**ç¼–è¯‘EventPSï¼ˆæ¨èé…ç½®ï¼‰**:
```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS

# ç¼–è¯‘ï¼ˆä»…Python GUI + æ¸²æŸ“ï¼‰
cargo build --release --features loader_render

# å®Œæ•´ç¼–è¯‘ï¼ˆåŒ…å«Rust GUIï¼‰
cargo build --release --features display_cv,display_gl,loader_render
```

**éªŒè¯ç¼–è¯‘**:
```bash
ls -lh target/release/event_ps_*
# åº”è¯¥çœ‹åˆ°: event_ps_eval, event_ps_train
```

---

### ğŸ“¦ æ•°æ®å‡†å¤‡ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰

**å‡†å¤‡DiLiGenTè¯„ä¼°æ•°æ®**:
```bash
# 1. ä¸‹è½½DiLiGenT.zipåˆ°data/ç›®å½•
# 2. è½¬æ¢æ•°æ®é›†
bash ./scripts/diligent_convert.sh

# 3. éªŒè¯
ls -d data/diligent/*/
```

**å‡†å¤‡è®­ç»ƒæ•°æ®**:
```bash
# 1. å¯åŠ¨LibreDRæœåŠ¡
cd /home/c303/cxz/LibreDR
nohup ./libredr_server > libredr_server.log 2>&1 &
nohup ./libredr_worker > libredr_worker.log 2>&1 &

# 2. æ¸²æŸ“è®­ç»ƒæ•°æ®
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
nohup bash ./scripts/render.sh > render.log 2>&1 &

# 3. ç›‘æ§è¿›åº¦
tail -f render.log
```

**å‡†å¤‡PS-FCNé¢„è®­ç»ƒæ¨¡å‹**:
```bash
# 1. ä» https://github.com/guanyingc/PS-FCN ä¸‹è½½ PS-FCN_B_S_32.pth.tar
# 2. æ”¾ç½®åˆ°æ­£ç¡®ä½ç½®
mkdir -p python/ev_ps_fcn/PS-FCN/data/models/
mv ~/Downloads/PS-FCN_B_S_32.pth.tar python/ev_ps_fcn/PS-FCN/data/models/

# 3. éªŒè¯
ls -lh python/ev_ps_fcn/PS-FCN/data/models/PS-FCN_B_S_32.pth.tar
```

---

### ğŸš€ ç¯å¢ƒå‡†å¤‡ï¼ˆæ¯æ¬¡ä½¿ç”¨å‰å¿…é¡»ï¼‰
```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate
```

---

### ğŸ“Š è¯„ä¼°æ¨¡å‹ï¼ˆä¸€é”®ç”ŸæˆæŠ¥å‘Šï¼‰â­

#### é‡è¦æç¤º âš ï¸
- CNN-PS ä½¿ç”¨ `eval_cnn_ps.ini` é…ç½®æ–‡ä»¶
- PS-FCN ä½¿ç”¨ `eval_ps_fcn.ini` é…ç½®æ–‡ä»¶
- è¯„ä¼°è„šæœ¬ä¸­çš„æ¨¡å‹è·¯å¾„æ˜¯ç¡¬ç¼–ç çš„ï¼Œéœ€è¦æ‰‹åŠ¨ä¿®æ”¹

#### å®Œæ•´è¯„ä¼°æµç¨‹ï¼ˆæ¨èï¼‰

```bash
# ç¯å¢ƒå‡†å¤‡
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# CNN-PS: æ‰¹é‡è¯„ä¼° â†’ ç”ŸæˆæŠ¥å‘Š
nohup bash -c "source venv/bin/activate && \
  for dir in data/diligent/*/; do \
    ./target/release/event_ps_eval_python_gui \${dir}eval_cnn_ps.ini; \
  done" > logs/eval_cnn_$(date +%Y%m%d_%H%M%S).log 2>&1 &

# ç­‰å¾…å®Œæˆåï¼Œä¸€é”®ç”ŸæˆæŠ¥å‘Š
python3 generate_evaluation_report.py logs/eval_cnn_20251104_180530.log

# PS-FCN: æ‰¹é‡è¯„ä¼° â†’ ç”ŸæˆæŠ¥å‘Š  
nohup bash -c "source venv/bin/activate && \
  for dir in data/diligent/*/; do \
    ./target/release/event_ps_eval_python_gui \${dir}eval_ps_fcn.ini; \
  done" > logs/eval_fcn_$(date +%Y%m%d_%H%M%S).log 2>&1 &

# ç­‰å¾…å®Œæˆåï¼Œä¸€é”®ç”ŸæˆæŠ¥å‘Š
python3 generate_evaluation_report.py logs/eval_fcn_20251104_091804.log
```

**æŠ¥å‘Šä¼šè‡ªåŠ¨ä¿å­˜åˆ°**: `eval_report/<model_type>_report_<timestamp>/`

---

#### 1ï¸âƒ£ è¯„ä¼° CNN-PS æ¨¡å‹

**æ­¥éª¤1: æ£€æŸ¥å’Œä¿®æ”¹æ¨¡å‹è·¯å¾„**:
```bash
# æŸ¥çœ‹å¯ç”¨æ¨¡å‹
ls -lh data/models/ev_cnn_ps_*.bin

# ç¼–è¾‘è¯„ä¼°è„šæœ¬ï¼ˆç¬¬88è¡Œï¼‰
nano python/cnn_ps_eval.py
# ä¿®æ”¹ä¸º: NET.load_state_dict(torch.load("data/models/ev_cnn_ps_official_download.bin")["model_state_dict"])
```

**æ­¥éª¤2: å•ä¸ªæ•°æ®é›†è¯„ä¼°**:
```bash
./target/release/event_ps_eval_python_gui data/diligent/000000/eval_cnn_ps.ini
```

**æ­¥éª¤3: æ‰¹é‡è¯„ä¼°æ‰€æœ‰æ•°æ®é›†**:
```bash
# å‰å°è¯„ä¼°ï¼ˆæ¨èï¼‰
for dir in data/diligent/*/; do
    echo "è¯„ä¼° $dir"
    ./target/release/event_ps_eval_python_gui ${dir}eval_cnn_ps.ini
done

# åå°è¯„ä¼°
nohup bash -c "for dir in data/diligent/*/; do ./target/release/event_ps_eval_python_gui \${dir}eval_cnn_ps.ini; done" > eval_cnn.log 2>&1 &
```

**æŸ¥çœ‹å®æ—¶è¯„ä¼°ç»“æœ**:
```
Loaded model: ev_cnn_ps_official_download.bin
BENCHMARK Event-LS-PS n_pixels 33785 ang_err_mean 10.99
BENCHMARK Event-CNN-PS n_pixels 33785 ang_err_mean 10.16  â† CNNç»“æœ
```

**GUIçª—å£**:
- `normal_gt` - çœŸå®æ³•çº¿
- `buffer_show` - äº‹ä»¶ç¼“å†²åŒº
- `normal_pred` - CNNé¢„æµ‹ç»“æœ â­

---

#### 2ï¸âƒ£ è¯„ä¼° PS-FCN æ¨¡å‹

**æ­¥éª¤1: æ£€æŸ¥å’Œä¿®æ”¹æ¨¡å‹è·¯å¾„**:
```bash
# æŸ¥çœ‹å¯ç”¨æ¨¡å‹ï¼ˆæŒ‰æ—¶é—´æ’åºï¼Œæœ€æ–°åœ¨å‰ï¼‰
ls -lht data/models/ev_ps_fcn_*.bin | head -10

# ç¼–è¾‘è¯„ä¼°è„šæœ¬ï¼ˆç¬¬78è¡Œï¼‰
nano python/ps_fcn_eval.py
# ä¿®æ”¹ä¸º: NET.load_state_dict(torch.load("data/models/ev_ps_fcn_020000.bin")["model_state_dict"])
```

**æ­¥éª¤2: å•ä¸ªæ•°æ®é›†è¯„ä¼°** âš ï¸ æ³¨æ„ä½¿ç”¨ `eval_ps_fcn.ini`ï¼š
```bash
./target/release/event_ps_eval_python_gui data/diligent/000000/eval_ps_fcn.ini
```

**æ­¥éª¤3: æ‰¹é‡è¯„ä¼°æ‰€æœ‰æ•°æ®é›†**:
```bash
# å‰å°è¯„ä¼°ï¼ˆæ¨èï¼‰
for dir in data/diligent/*/; do
    echo "è¯„ä¼° PS-FCN: $dir"
    ./target/release/event_ps_eval_python_gui ${dir}eval_ps_fcn.ini
done

# åå°è¯„ä¼°
nohup bash -c "for dir in data/diligent/*/; do ./target/release/event_ps_eval_python_gui \${dir}eval_ps_fcn.ini; done" > eval_fcn.log 2>&1 &
```

**æŸ¥çœ‹å®æ—¶è¯„ä¼°ç»“æœ**:
```
Loaded model: ev_ps_fcn_020000.bin
BENCHMARK Event-LS-PS n_pixels 33785 ang_err_mean 10.99
BENCHMARK Event-PS-FCN n_pixels 33785 ang_err_mean 12.35
```

---

### ğŸ“ è®­ç»ƒæ¨¡å‹

#### 1ï¸âƒ£ è®­ç»ƒ CNN-PS æ¨¡å‹

**æ–¹å¼1: å‰å°è®­ç»ƒ + ä¿å­˜æ—¥å¿—ï¼ˆæ¨èï¼‰** â­:
```bash
# åˆ›å»ºlogsç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
mkdir -p logs

# å‰å°è®­ç»ƒå¹¶ä¿å­˜æ—¥å¿—åˆ°logsç›®å½•
CUDA_VISIBLE_DEVICES=0 DISPLAY=:1 PYTHONUNBUFFERED=1 ./target/release/event_ps_train \
    --cnn-ps-train python/cnn_ps_train.py \
    2>&1 | tee logs/train_cnn_$(date +%Y%m%d_%H%M%S).log
```
- âœ… ç»ˆç«¯å®æ—¶æ˜¾ç¤ºè®­ç»ƒè¿›åº¦
- âœ… åŒæ—¶ä¿å­˜åˆ°logsç›®å½•
- âœ… å¯ä»¥æŒ‰Ctrl+Cåœæ­¢
- âš ï¸ å…³é—­ç»ˆç«¯ä¼šåœæ­¢è®­ç»ƒ

**æ–¹å¼2: åå°è®­ç»ƒ + ä¿å­˜æ—¥å¿—ï¼ˆé•¿æ—¶é—´è®­ç»ƒï¼‰**:
```bash
# åˆ›å»ºlogsç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
mkdir -p logs

# åå°è®­ç»ƒå¹¶ä¿å­˜æ—¥å¿—åˆ°logsç›®å½•
nohup bash -c "source venv/bin/activate && CUDA_VISIBLE_DEVICES=0 DISPLAY=:1 PYTHONUNBUFFERED=1 \
    ./target/release/event_ps_train --cnn-ps-train python/cnn_ps_train.py" \
    > logs/train_cnn_$(date +%Y%m%d_%H%M%S).log 2>&1 &
```
- âœ… åå°è¿è¡Œï¼Œå…³é—­ç»ˆç«¯è®­ç»ƒç»§ç»­
- âœ… ä¿å­˜åˆ°logsç›®å½•
- âœ… é€‚åˆé•¿æ—¶é—´æ— äººå€¼å®ˆè®­ç»ƒ

**æ–¹å¼3: ä»…ç»ˆç«¯æ˜¾ç¤ºï¼ˆä¸æ¨èï¼‰**:
```bash
./target/release/event_ps_train --cnn-ps-train python/cnn_ps_train.py
```
- âŒ ä¸ä¿å­˜logæ–‡ä»¶
- âŒ æ— æ³•å›æº¯æŸ¥çœ‹å†å²è¾“å‡º
- âŒ ä»…é€‚åˆå¿«é€Ÿæµ‹è¯•

**å®æ—¶æŸ¥çœ‹è®­ç»ƒè¿›åº¦** â­:
```bash
# æ–¹æ³•1: æŸ¥çœ‹æ‰€æœ‰è¾“å‡º
tail -f logs/train_cnn_*.log

# æ–¹æ³•2: åªçœ‹è¿­ä»£å’Œlossï¼ˆæ¨èï¼‰
tail -f logs/train_cnn_*.log | grep --line-buffered "iter"

# æ–¹æ³•3: æ¯æ¬¡æ˜¾ç¤ºæœ€æ–°çš„10æ¬¡è¿­ä»£
watch -n 2 "tail -20 logs/train_cnn_*.log | grep iter | tail -10"

# æ–¹æ³•4: æŸ¥çœ‹GPUä½¿ç”¨æƒ…å†µ
watch -n 1 nvidia-smi
```

**è®­ç»ƒå‚æ•°**:
- è¿­ä»£æ¬¡æ•°: è‡ªå®šä¹‰
- ä¿å­˜é¢‘ç‡: æ¯500æ¬¡
- å­¦ä¹ ç‡è¡°å‡: 6000/12000/18000æ¬¡
- æ¨¡å‹ä¿å­˜ä½ç½®: `data/models/ev_cnn_ps_<iter>.bin`

---

#### 2ï¸âƒ£ è®­ç»ƒ PS-FCN æ¨¡å‹ï¼ˆæ¨èè‡ªåŠ¨æ¢å¤ï¼‰â­

**å¯åŠ¨è‡ªåŠ¨æ¢å¤è®­ç»ƒï¼ˆæ¨èï¼‰**:
```bash
# å¯åŠ¨è„šæœ¬
nohup ./auto_train_ps_fcn.sh > /dev/null 2>&1 &
```

**å®æ—¶æŸ¥çœ‹è®­ç»ƒè¿›åº¦** â­:
```bash
# æ–¹æ³•1: åªçœ‹è¿­ä»£å’Œlossï¼ˆæ¨èï¼‰
tail -f logs/auto_train_main_*.log | grep --line-buffered "iter"

# æ–¹æ³•2: æŸ¥çœ‹åŒ…å«loss_meançš„è¡Œ
tail -f logs/auto_train_main_*.log | grep "iter.*loss_mean"

# æ–¹æ³•3: æŸ¥çœ‹æ‰€æœ‰è®­ç»ƒè¾“å‡º
tail -f logs/auto_train_main_*.log

# æ–¹æ³•4: æ¯æ¬¡æ˜¾ç¤ºæœ€æ–°çš„10æ¬¡è¿­ä»£
watch -n 2 "tail -50 logs/auto_train_main_*.log | grep iter | tail -10"

# æ–¹æ³•5: æŸ¥çœ‹GPUä½¿ç”¨æƒ…å†µ
watch -n 1 nvidia-smi
```

**æŸ¥çœ‹è®­ç»ƒçŠ¶æ€**:
```bash
# æŸ¥çœ‹æœ€æ–°checkpoint
ls -lht data/models/ev_ps_fcn_*.bin | head -1

# æŸ¥çœ‹é‡å¯æ—¥å¿—
tail -20 logs/auto_train_restarts_*.log

# æŸ¥çœ‹å½“å‰è¿›ç¨‹
ps aux | grep auto_train_ps_fcn

# ç»Ÿè®¡å·²é‡å¯æ¬¡æ•°
grep "Attempt" logs/auto_train_restarts_*.log | wc -l
```

**åœæ­¢è®­ç»ƒ**:
```bash
# æŸ¥æ‰¾è¿›ç¨‹
ps aux | grep auto_train_ps_fcn

# åœæ­¢ï¼ˆæ›¿æ¢<PID>ä¸ºå®é™…è¿›ç¨‹å·ï¼‰
kill <PID>
```

**è®­ç»ƒå‚æ•°**:
- æœ€å¤§è¿­ä»£: 10000æ¬¡
- ä¿å­˜é¢‘ç‡: æ¯3000æ¬¡
- å­¦ä¹ ç‡è¡°å‡: 3000/6000/9000æ¬¡
- æ¨¡å‹ä½ç½®: `data/models/ev_ps_fcn_<iter>.bin`
- è‡ªåŠ¨æ¢å¤: âœ… å´©æºƒåè‡ªåŠ¨é‡å¯

---

### ğŸ” å¸¸ç”¨æ£€æŸ¥å‘½ä»¤

```bash
# æŸ¥çœ‹æ‰€æœ‰æ¨¡å‹
ls -lh data/models/*.bin

# æŸ¥çœ‹è®­ç»ƒè¿›ç¨‹
ps aux | grep event_ps_train

# æŸ¥çœ‹GPUä½¿ç”¨
nvidia-smi

# æŸ¥çœ‹ç£ç›˜ç©ºé—´
df -h

# åœæ­¢CNN-PSè®­ç»ƒ
pkill -f "cnn_ps_train"

# åœæ­¢PS-FCNè‡ªåŠ¨æ¢å¤è®­ç»ƒ
pkill -f auto_train_ps_fcn && pkill -f event_ps_train

# åœæ­¢æ‰€æœ‰è®­ç»ƒè¿›ç¨‹
pkill -f event_ps_train
```

---

### ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æ¨¡å‹ | å¹³å‡è¯¯å·® | vs LS-PS | è®­ç»ƒæ¬¡æ•° | çŠ¶æ€ |
|------|---------|---------|---------|------|
| **LS-PS** | 19.73Â° | åŸºå‡† | - | ç»å…¸æ–¹æ³• |
| **CNN-PS** | **15.63Â°** | âœ… æå‡20.8% | 19500æ¬¡ | â­ æ¨è |
| **PS-FCN** | 20.85Â° | âŒ è½å5.7% | 9000æ¬¡ | è®­ç»ƒä¸­ |

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ç»“æ„
```
/home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS/
â”œâ”€â”€ target/release/
â”‚   â”œâ”€â”€ event_ps_eval              # é»˜è®¤è¯„ä¼°ç¨‹åºï¼ˆPython GUIç‰ˆæœ¬ï¼‰
â”‚   â”œâ”€â”€ event_ps_eval_python_gui   # Python GUIç‰ˆæœ¬ï¼ˆæ˜¾ç¤ºCNNç»“æœï¼‰â­ æ¨è
â”‚   â”œâ”€â”€ event_ps_eval_rust_gui     # Rust GUIç‰ˆæœ¬ï¼ˆæ˜¾ç¤ºLS-PSç»“æœï¼‰
â”‚   â”œâ”€â”€ event_ps_train             # è®­ç»ƒç¨‹åºï¼ˆPython GUIç‰ˆæœ¬ï¼‰â­
â”‚   â””â”€â”€ event_ps_train_python_gui  # è®­ç»ƒç¨‹åºï¼ˆPython GUIç‰ˆæœ¬å¤‡ä»½ï¼‰
â”œâ”€â”€ python/
â”‚   â”œâ”€â”€ cnn_ps_eval.py            # CNNè¯„ä¼°è„šæœ¬
â”‚   â”œâ”€â”€ cnn_ps_train.py           # CNNè®­ç»ƒè„šæœ¬
â”‚   â”œâ”€â”€ ps_fcn_eval.py            # PS-FCNè¯„ä¼°è„šæœ¬
â”‚   â”œâ”€â”€ ps_fcn_train.py           # PS-FCNè®­ç»ƒè„šæœ¬
â”‚   â””â”€â”€ ev_cnn_ps.py              # CNNæ¨¡å‹å®šä¹‰
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ diligent/                 # DiLiGenTæ•°æ®é›†
â”‚   â”œâ”€â”€ models/                   # è®­ç»ƒå¥½çš„æ¨¡å‹
â”‚   â”‚   â””â”€â”€ ev_cnn_ps_019500.bin # æœ€æ–°è®­ç»ƒæ¨¡å‹
â”‚   â””â”€â”€ ...
â””â”€â”€ venv/                         # Pythonè™šæ‹Ÿç¯å¢ƒ
```

### æ¨¡å‹ä¿¡æ¯
- **æ¨¡å‹åç§°**: ev_cnn_ps_019500.bin
- **è®­ç»ƒè¿­ä»£**: 19500æ¬¡
- **æ€§èƒ½æå‡**: ç›¸æ¯”LS-PSå¹³å‡æå‡20.78%
- **åº”ç”¨åœºæ™¯**: åŸºäºäº‹ä»¶ç›¸æœºçš„å…‰åº¦ç«‹ä½“è§†è§‰æ³•çº¿é‡å»º

---

## ä»æºä»£ç æ„å»º

### ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Linux (æ¨è Debian/Ubuntu)
- **ç¼–è¯‘å™¨**: Rust (é€šè¿‡ rustup å®‰è£…)
- **Python**: Python 3.10+
- **GPU**: NVIDIA GPU with CUDA support (æ¨è RTX 3090 æˆ–ä»¥ä¸Š)
- **é©±åŠ¨**: NVIDIA Proprietary Driver v470+

### å®‰è£…ä¾èµ–

#### 1. å®‰è£… Rust
```bash
# å®‰è£… rustup
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source $HOME/.cargo/env

# éªŒè¯å®‰è£…
rustc --version
cargo --version
```

#### 2. å®‰è£… Python ä¾èµ–
```bash
# åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–åŒ…
pip install -r python/requirements.txt
```

#### 3. å®‰è£…ç³»ç»Ÿä¾èµ–ï¼ˆOpenCVç­‰ï¼‰
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install -y \
    libopencv-dev \
    clang \
    libclang-dev \
    pkg-config
```

### ç¼–è¯‘é€‰é¡¹è¯´æ˜

é¡¹ç›®æ”¯æŒå¤šä¸ªå¯é€‰åŠŸèƒ½ç‰¹æ€§ï¼ˆfeaturesï¼‰ï¼Œæ ¹æ®éœ€è¦é€‰æ‹©ï¼š

#### display_cv
- **åŠŸèƒ½**: åœ¨Rustç«¯ä½¿ç”¨OpenCVæ˜¾ç¤ºç»“æœ
- **ç”¨é€”**: å¯ç”¨åï¼Œé…ç½®æ–‡ä»¶ä¸­ `show_ls_ps = cv` å¯ç”¨
- **ä¾èµ–**: libopencv-dev

#### display_gl
- **åŠŸèƒ½**: åœ¨Rustç«¯ä½¿ç”¨OpenGLæ˜¾ç¤ºç»“æœ
- **ç”¨é€”**: å¯ç”¨åï¼Œé…ç½®æ–‡ä»¶ä¸­ `show_ls_ps = gl` å¯ç”¨
- **ä¼˜åŠ¿**: æ›´é«˜åˆ·æ–°ç‡ï¼Œå‡å°‘æ•°æ®æ‹·è´
- **è¦æ±‚**: OpenGLè®¾å¤‡å¿…é¡»ä¸OpenCLè®¾å¤‡ç›¸åŒ

#### loader_render
- **åŠŸèƒ½**: ä¸ºBlobbyã€Sculptureå’ŒDiLiGenTæ•°æ®é›†æ¸²æŸ“äº‹ä»¶
- **ä¾èµ–**: éœ€è¦è¿è¡Œä¸­çš„ [LibreDR](https://codeberg.org/ybh1998/LibreDR/) æœåŠ¡å™¨å’Œworker
- **å¿…éœ€**: è®­ç»ƒæ¨¡å‹å’ŒDiLiGenTæ•°æ®é›†è¯„ä¼°æ—¶éœ€è¦

#### loader_prophesee
- **åŠŸèƒ½**: ä»PROPHESEEäº‹ä»¶ç›¸æœºå®æ—¶æ•è·äº‹ä»¶
- **ä¾èµ–**: [OpenEB](https://github.com/prophesee-ai/openeb) v4.x
- **ç”¨é€”**: å®æ—¶ç¡¬ä»¶é‡‡é›†ï¼ˆå¯é€‰ï¼‰

### ç¼–è¯‘é¡¹ç›®

#### å®Œæ•´ç¼–è¯‘ï¼ˆåŒ…å«æ‰€æœ‰åŠŸèƒ½ï¼‰
```bash
cargo build --release --features display_cv,display_gl,loader_render,loader_prophesee
```

#### æ¨èç¼–è¯‘ï¼ˆä»…ç”¨äºè®­ç»ƒå’Œè¯„ä¼°ï¼‰â­
```bash
# Python GUIç‰ˆæœ¬ï¼ˆæ¨èï¼‰
cargo build --release --features loader_render

# ç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶ä½äºï¼š
# - target/release/event_ps_eval
# - target/release/event_ps_train
```

#### ä»…è¯„ä¼°ï¼ˆä¸è®­ç»ƒï¼‰
```bash
cargo build --release --features display_cv
```

### å®‰è£…åˆ°ç³»ç»Ÿï¼ˆå¯é€‰ï¼‰
```bash
cargo install --path . --features loader_render
# å®‰è£…åå¯å…¨å±€ä½¿ç”¨ event_ps_eval å’Œ event_ps_train å‘½ä»¤
```

### éªŒè¯ç¼–è¯‘
```bash
# æ£€æŸ¥å¯æ‰§è¡Œæ–‡ä»¶
ls -lh target/release/event_ps_*

# é¢„æœŸè¾“å‡ºï¼š
# event_ps_eval
# event_ps_train
```

---

## æ•°æ®å‡†å¤‡

### æ•°æ®é›†æ¦‚è§ˆ

EventPSé¡¹ç›®æ”¯æŒä¸‰ç§ç±»å‹çš„æ•°æ®é›†ï¼š

| æ•°æ®é›† | ç”¨é€” | å¤§å° | éœ€è¦æ¸²æŸ“ |
|--------|------|------|---------|
| **DiLiGenT** | è¯„ä¼°æµ‹è¯• | ~2GB | âœ… æ˜¯ |
| **Blobby** | è®­ç»ƒ | è‡ªåŠ¨ç”Ÿæˆ | âœ… æ˜¯ |
| **Sculpture** | è®­ç»ƒ | è‡ªåŠ¨ç”Ÿæˆ | âœ… æ˜¯ |

---

### å‡†å¤‡DiLiGenTæ•°æ®é›†ï¼ˆè¯„ä¼°ç”¨ï¼‰â­

DiLiGenTæ˜¯æ ‡å‡†çš„å…‰åº¦ç«‹ä½“è§†è§‰æ•°æ®é›†ï¼Œç”¨äºè¯„ä¼°æ¨¡å‹æ€§èƒ½ã€‚

#### 1. ä¸‹è½½DiLiGenTæ•°æ®é›†
```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS

# ä»å®˜æ–¹ç½‘ç«™ä¸‹è½½
# https://sites.google.com/site/photometricstereodata/single
# å°† DiLiGenT.zip ä¿å­˜åˆ° data/DiLiGenT.zip
```

**æˆ–ä½¿ç”¨wgetä¸‹è½½**:
```bash
# æ³¨æ„ï¼šéœ€è¦å…ˆä»å®˜ç½‘è·å–å®é™…ä¸‹è½½é“¾æ¥
wget -O data/DiLiGenT.zip [ä¸‹è½½é“¾æ¥]
```

#### 2. è½¬æ¢DiLiGenTæ•°æ®é›†
```bash
# ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
source venv/bin/activate

# è¿è¡Œè½¬æ¢è„šæœ¬ï¼ˆè‡ªåŠ¨è§£å‹ã€è½¬æ¢æ ¼å¼ï¼‰
bash ./scripts/diligent_convert.sh

# è„šæœ¬ä¼šï¼š
# 1. æ¸…ç†æ—§æ•°æ®: rm -rf data/diligent/
# 2. è§£å‹DiLiGenT.zip
# 3. è½¬æ¢ä¸ºEventPSæ ¼å¼
# 4. æ¸²æŸ“äº‹ä»¶æ•°æ®
```

**è½¬æ¢åçš„ç›®å½•ç»“æ„**:
```
data/diligent/
â”œâ”€â”€ 000000/  # Ball
â”œâ”€â”€ 000002/  # Bear
â”œâ”€â”€ 000003/  # Buddha
â”œâ”€â”€ 000004/  # Cat
â”œâ”€â”€ 000005/  # Cow
â”œâ”€â”€ 000006/  # Goblet
â”œâ”€â”€ 000007/  # Harvest
â”œâ”€â”€ 000008/  # Pot1
â””â”€â”€ 000009/  # Pot2
```

**æ¯ä¸ªæ•°æ®é›†åŒ…å«**:
```
data/diligent/000000/
â”œâ”€â”€ render.ini              # æ¸²æŸ“é…ç½®
â”œâ”€â”€ eval_cnn_ps.ini        # CNNè¯„ä¼°é…ç½®
â”œâ”€â”€ eval_ps_fcn.ini        # PS-FCNè¯„ä¼°é…ç½®
â”œâ”€â”€ event_internal.xz      # æ¸²æŸ“çš„äº‹ä»¶æ•°æ®
â”œâ”€â”€ event.xz               # é“¾æ¥åˆ°event_internal.xz
â”œâ”€â”€ normal.xz              # Ground Truthæ³•çº¿
â””â”€â”€ frames/*.png           # æ¸²æŸ“çš„å›¾åƒå¸§
```

#### 3. éªŒè¯DiLiGenTæ•°æ®
```bash
# æ£€æŸ¥æ˜¯å¦æ‰€æœ‰æ•°æ®é›†éƒ½å·²ç”Ÿæˆ
ls -d data/diligent/*/

# æ£€æŸ¥äº‹ä»¶æ•°æ®æ˜¯å¦å­˜åœ¨
ls -lh data/diligent/*/event.xz

# é¢„æœŸè¾“å‡º9ä¸ªæ•°æ®é›†ï¼Œæ¯ä¸ªéƒ½æœ‰event.xzæ–‡ä»¶
```

---

### å‡†å¤‡è®­ç»ƒæ•°æ®é›†ï¼ˆè®­ç»ƒç”¨ï¼‰

è®­ç»ƒCNN-PSå’ŒPS-FCNæ¨¡å‹éœ€è¦æ¸²æŸ“çš„è®­ç»ƒæ•°æ®ã€‚

#### å‰ç½®è¦æ±‚ï¼šå¯åŠ¨LibreDRæœåŠ¡

è®­ç»ƒæ•°æ®æ¸²æŸ“éœ€è¦è¿è¡Œä¸­çš„LibreDRæœåŠ¡å™¨ã€‚

**æ£€æŸ¥LibreDRæœåŠ¡çŠ¶æ€**:
```bash
# æ£€æŸ¥LibreDRè¿›ç¨‹
ps aux | grep libredr

# æ£€æŸ¥æ—¥å¿—
tail -f /home/c303/cxz/LibreDR/libredr_server.log
tail -f /home/c303/cxz/LibreDR/libredr_worker.log
```

**å¯åŠ¨LibreDRæœåŠ¡** (å¦‚æœæœªè¿è¡Œ):
```bash
cd /home/c303/cxz/LibreDR

# å¯åŠ¨æœåŠ¡å™¨
nohup ./libredr_server > libredr_server.log 2>&1 &

# å¯åŠ¨worker
nohup ./libredr_worker > libredr_worker.log 2>&1 &

# éªŒè¯æœåŠ¡è¿è¡Œ
ps aux | grep libredr_server
ps aux | grep libredr_worker
```

#### æ¸²æŸ“è®­ç»ƒå’Œè¯„ä¼°æ•°æ®
```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# è¿è¡Œæ¸²æŸ“è„šæœ¬ï¼ˆéœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œå»ºè®®åå°è¿è¡Œï¼‰
nohup bash ./scripts/render.sh > render.log 2>&1 &

# ç›‘æ§æ¸²æŸ“è¿›åº¦
tail -f render.log

# è„šæœ¬ä¼šï¼š
# 1. æ¸…ç†æ—§æ•°æ®
# 2. ç”Ÿæˆæ¸²æŸ“é…ç½®
# 3. æ¸²æŸ“ Blobby è®­ç»ƒæ•°æ®
# 4. æ¸²æŸ“ Blobby è¯„ä¼°æ•°æ®
# 5. æ¸²æŸ“ Sculpture è®­ç»ƒæ•°æ®
# 6. æ¸²æŸ“ Sculpture è¯„ä¼°æ•°æ®
```

**æ¸²æŸ“åçš„ç›®å½•ç»“æ„**:
```
data/
â”œâ”€â”€ blobs_training/      # Blobbyè®­ç»ƒæ•°æ®
â”œâ”€â”€ blobs_eval/          # Blobbyè¯„ä¼°æ•°æ®
â”œâ”€â”€ sculptures_training/ # Sculptureè®­ç»ƒæ•°æ®
â””â”€â”€ sculptures_eval/     # Sculptureè¯„ä¼°æ•°æ®
```

**é¢„è®¡æ—¶é—´**: å–å†³äºGPUæ€§èƒ½å’Œæ•°æ®é‡ï¼Œå¯èƒ½éœ€è¦æ•°å°æ—¶åˆ°æ•°å¤©ã€‚

#### éªŒè¯è®­ç»ƒæ•°æ®
```bash
# æ£€æŸ¥è®­ç»ƒæ•°æ®ç›®å½•
ls -d data/blobs_training/*/
ls -d data/sculptures_training/*/

# æ£€æŸ¥äº‹ä»¶æ•°æ®
ls -lh data/blobs_training/*/event.xz
ls -lh data/sculptures_training/*/event.xz
```

---

### å‡†å¤‡PS-FCNé¢„è®­ç»ƒæ¨¡å‹

è®­ç»ƒPS-FCNæ¨¡å‹éœ€è¦åŸå§‹PS-FCNçš„é¢„è®­ç»ƒæƒé‡ä½œä¸ºåˆå§‹åŒ–ã€‚

#### 1. ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹
```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS

# åˆ›å»ºç›®å½•
mkdir -p python/ev_ps_fcn/PS-FCN/data/models/

# ä»PS-FCNå®˜æ–¹ä»“åº“ä¸‹è½½
# GitHub: https://github.com/guanyingc/PS-FCN
# ä¸‹è½½æ–‡ä»¶: PS-FCN_B_S_32.pth.tar
```

**æ‰‹åŠ¨ä¸‹è½½**:
1. è®¿é—® https://github.com/guanyingc/PS-FCN
2. æŒ‰ç…§è¯´æ˜ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹ `PS-FCN_B_S_32.pth.tar`
3. æ”¾ç½®åˆ° `python/ev_ps_fcn/PS-FCN/data/models/PS-FCN_B_S_32.pth.tar`

#### 2. éªŒè¯é¢„è®­ç»ƒæ¨¡å‹
```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -lh python/ev_ps_fcn/PS-FCN/data/models/PS-FCN_B_S_32.pth.tar

# é¢„æœŸå¤§å°çº¦ 50-100MB
```

**æ³¨æ„**: 
- âœ… **CNN-PSæ¨¡å‹**ä¸éœ€è¦é¢„è®­ç»ƒæ¨¡å‹ï¼Œä»é›¶å¼€å§‹è®­ç»ƒå³å¯
- âš ï¸ **PS-FCNæ¨¡å‹**å¿…é¡»æœ‰é¢„è®­ç»ƒæ¨¡å‹æ‰èƒ½å¼€å§‹è®­ç»ƒ

---

### æ•°æ®å‡†å¤‡æ¸…å•

åœ¨å¼€å§‹è®­ç»ƒå‰ï¼Œç¡®ä¿å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š

#### è¯„ä¼°DiLiGenTæ•°æ®é›†
- [x] ä¸‹è½½ `data/DiLiGenT.zip`
- [x] è¿è¡Œ `bash ./scripts/diligent_convert.sh`
- [x] éªŒè¯ `data/diligent/*/event.xz` å­˜åœ¨

#### CNN-PSè®­ç»ƒï¼ˆæœ€ç®€å•ï¼‰
- [x] å¯åŠ¨LibreDRæœåŠ¡
- [x] è¿è¡Œ `bash ./scripts/render.sh`
- [x] éªŒè¯è®­ç»ƒæ•°æ®å­˜åœ¨
- [x] âœ… ä¸éœ€è¦é¢„è®­ç»ƒæ¨¡å‹

#### PS-FCNè®­ç»ƒï¼ˆéœ€è¦é¢„è®­ç»ƒï¼‰
- [x] å¯åŠ¨LibreDRæœåŠ¡
- [x] è¿è¡Œ `bash ./scripts/render.sh`
- [x] éªŒè¯è®­ç»ƒæ•°æ®å­˜åœ¨
- [x] ä¸‹è½½ `PS-FCN_B_S_32.pth.tar`
- [x] æ”¾ç½®åˆ° `python/ev_ps_fcn/PS-FCN/data/models/`

---

## å¯æ‰§è¡Œæ–‡ä»¶è¯´æ˜

### è¯„ä¼°å¯æ‰§è¡Œæ–‡ä»¶

#### 1ï¸âƒ£ event_ps_eval_python_gui â­ **æ¨èç”¨äºCNNè¯„ä¼°**

**ç‰¹ç‚¹**:
- âœ… æ˜¾ç¤ºCNNæ¨¡å‹é¢„æµ‹ç»“æœ
- âœ… åŒæ—¶æ˜¾ç¤ºground truthå’Œäº‹ä»¶ç¼“å†²åŒº
- âœ… é€‚åˆæ¨¡å‹è°ƒè¯•å’Œè®ºæ–‡å±•ç¤º
- âš ï¸ ä¸èƒ½åŒæ—¶ä½¿ç”¨Rustç«¯GUI

**é“¾æ¥åº“**: 
- Python 3.10 âœ“
- OpenCV (Pythonä¾§) âœ“
- OpenCV (Rustä¾§) âœ—

**GUIçª—å£**:
- `normal_gt` - çœŸå®æ³•çº¿
- `buffer_show` - äº‹ä»¶ç¼“å†²åŒº
- `normal_pred` - CNNé¢„æµ‹æ³•çº¿

---

#### 2ï¸âƒ£ event_ps_eval_rust_gui - **ç”¨äºLS-PSç»å…¸æ–¹æ³•**

**ç‰¹ç‚¹**:
- âœ… æ˜¾ç¤ºLS-PSç»å…¸æ–¹æ³•ç»“æœ
- âœ… æ€§èƒ½æ›´å¥½ï¼Œåˆ·æ–°ç‡æ›´é«˜
- âš ï¸ ä¸æ˜¾ç¤ºCNNæ¨¡å‹ç»“æœ
- âš ï¸ éœ€è¦ç¦ç”¨Pythonç«¯GUI

**é“¾æ¥åº“**:
- Python 3.10 âœ“
- OpenCV (Pythonä¾§) âœ—
- OpenCV (Rustä¾§) âœ“

**GUIçª—å£**:
- `Event-LS-PS event` - äº‹ä»¶æµ
- `Event-LS-PS normal` - LS-PSæ³•çº¿

---

### è®­ç»ƒå¯æ‰§è¡Œæ–‡ä»¶

#### 3ï¸âƒ£ event_ps_train / event_ps_train_python_gui â­ **Pythonç«¯GUIè®­ç»ƒ**

**ç‰¹ç‚¹**:
- âœ… æ”¯æŒCNN-PSå’ŒPS-FCNæ¨¡å‹è®­ç»ƒ
- âœ… å®æ—¶æ˜¾ç¤ºè®­ç»ƒè¿‡ç¨‹ï¼ˆPythonç«¯GUIï¼‰
- âœ… æ˜¾ç¤ºground truthã€äº‹ä»¶ç¼“å†²åŒºå’Œé¢„æµ‹ç»“æœ
- âœ… å®æ—¶è¾“å‡ºè¿­ä»£æ¬¡æ•°å’Œloss
- âœ… è‡ªåŠ¨ä¿å­˜checkpoint
- âš ï¸ ä¸èƒ½åŒæ—¶ä½¿ç”¨Rustç«¯GUI

**é“¾æ¥åº“**: 
- Python 3.10 âœ“
- OpenCV (Pythonä¾§) âœ“
- OpenCV (Rustä¾§) âœ—

**è®­ç»ƒç±»å‹**:
1. **CNN-PSè®­ç»ƒ** - ä½¿ç”¨ `--cnn-ps-train python/cnn_ps_train.py`
   - GUIçª—å£: `normal_gt`, `buffer_show`, `normal_pred`
   - æ¯500æ¬¡è¿­ä»£ä¿å­˜æ¨¡å‹åˆ° `data/models/ev_cnn_ps_<iter>.bin`
   
2. **PS-FCNè®­ç»ƒ** - ä½¿ç”¨ `--ps-fcn-train python/ps_fcn_train.py`
   - GUIçª—å£: `normal_gt`, `buffer_0/4/8/12`, `normal`
   - æ¯3000æ¬¡è¿­ä»£ä¿å­˜æ¨¡å‹åˆ° `data/models/ev_ps_fcn_<iter>.bin`

**ç¼–è¯‘å‘½ä»¤**:
```bash
cargo build --release --features loader_render
# ä¸å¯ç”¨ display_cv å’Œ display_glï¼Œé¿å…ä¸Python GUIå†²çª
```

---

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒå‡†å¤‡
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate
```

### å¿«é€Ÿè¯„ä¼°ï¼ˆPython GUI - æ¨èï¼‰
```bash
# è¯„ä¼°å•ä¸ªæ•°æ®é›†
./target/release/event_ps_eval_python_gui data/diligent/000000/eval_cnn_ps.ini

# è¯„ä¼°æ‰€æœ‰æ•°æ®é›†
for dir in data/diligent/*/; do
    ./target/release/event_ps_eval_python_gui ${dir}eval_cnn_ps.ini
done
```

### å¿«é€Ÿè®­ç»ƒï¼ˆPython GUIï¼‰
```bash
# CNN-PSè®­ç»ƒ
./target/release/event_ps_train --cnn-ps-train python/cnn_ps_train.py

# PS-FCNè®­ç»ƒ
./target/release/event_ps_train --ps-fcn-train python/ps_fcn_train.py
```

---

## GUIæ˜¾ç¤ºæ¨¡å¼

### æ¨¡å¼1: Python GUIï¼ˆæ˜¾ç¤ºCNNç»“æœï¼‰âœ… å½“å‰é…ç½®

**é…ç½®æ–‡ä»¶è¦æ±‚** (`data/diligent/*/eval_cnn_ps.ini`):
```ini
[ps]
show_ls_ps = none  # å…³é—­Rustç«¯GUI
cnn_ps_per_n_bin = 1
cnn_ps_python = python/cnn_ps_eval.py
```

**Pythonä»£ç è¦æ±‚** (`python/cnn_ps_eval.py`):
```python
# å¯ç”¨GUIæ˜¾ç¤º
cv.imshow("normal_gt", ...)
cv.imshow("buffer_show", ...)
cv.imshow("normal_pred", ...)
cv.waitKey(1)
```

**è¿è¡Œå‘½ä»¤**:
```bash
source venv/bin/activate
./target/release/event_ps_eval_python_gui data/diligent/000000/eval_cnn_ps.ini
```

**æ˜¾ç¤ºæ•ˆæœ**:
- çª—å£1: `normal_gt` - Ground Truthæ³•çº¿ï¼ˆå½©è‰²ï¼‰
- çª—å£2: `buffer_show` - äº‹ä»¶ç´¯ç§¯ç¼“å†²åŒºï¼ˆç°åº¦ï¼‰
- çª—å£3: `normal_pred` - CNNé¢„æµ‹æ³•çº¿ï¼ˆå½©è‰²ï¼‰â­

---

### æ¨¡å¼2: Rust GUIï¼ˆæ˜¾ç¤ºLS-PSç»“æœï¼‰

**é…ç½®æ–‡ä»¶è¦æ±‚**:
```ini
[ps]
show_ls_ps = cv  # å¯ç”¨OpenCVæ˜¾ç¤ºï¼Œæˆ– gl ä½¿ç”¨OpenGL
```

**Pythonä»£ç è¦æ±‚**:
```python
# ç¦ç”¨æ‰€æœ‰GUIæ˜¾ç¤ºï¼ˆé‡è¦ï¼ï¼‰
# cv.imshow("normal_gt", ...)     # æ³¨é‡Šæ‰
# cv.imshow("buffer_show", ...)   # æ³¨é‡Šæ‰
# cv.imshow("normal_pred", ...)   # æ³¨é‡Šæ‰
# cv.waitKey(1)                   # æ³¨é‡Šæ‰
```

**è¿è¡Œå‘½ä»¤**:
```bash
# 1. ä¿®æ”¹é…ç½®æ–‡ä»¶
sed -i 's/show_ls_ps = none/show_ls_ps = cv/' data/diligent/000000/eval_cnn_ps.ini

# 2. ç¦ç”¨Python GUIï¼ˆç¼–è¾‘python/cnn_ps_eval.pyï¼‰

# 3. è¿è¡Œè¯„ä¼°
source venv/bin/activate
./target/release/event_ps_eval_rust_gui data/diligent/000000/eval_cnn_ps.ini
```

**æ˜¾ç¤ºæ•ˆæœ**:
- çª—å£1: `Event-LS-PS event` - å®æ—¶äº‹ä»¶æµ
- çª—å£2: `Event-LS-PS normal` - LS-PSé‡å»ºæ³•çº¿

---

## è¯„ä¼°æ“ä½œ

### è¯„ä¼°æ¨¡å‹æ¦‚è§ˆ

EventPSæ”¯æŒä¸¤ç§æ¨¡å‹çš„è¯„ä¼°ï¼Œéœ€è¦ä½¿ç”¨å¯¹åº”çš„é…ç½®æ–‡ä»¶å’Œè¯„ä¼°è„šæœ¬ï¼š

| æ¨¡å‹ç±»å‹ | é…ç½®æ–‡ä»¶ | è¯„ä¼°è„šæœ¬ | é»˜è®¤æ¨¡å‹ |
|---------|---------|---------|---------|
| **CNN-PS** | `eval_cnn_ps.ini` | `python/cnn_ps_eval.py` | `ev_cnn_ps_official_download.bin` |
| **PS-FCN** | `eval_ps_fcn.ini` | `python/ps_fcn_eval.py` | `ev_ps_fcn_020000.bin` |

**âš ï¸ é‡è¦æç¤º**ï¼š
- è¯„ä¼°è„šæœ¬ä¸­çš„æ¨¡å‹è·¯å¾„æ˜¯**ç¡¬ç¼–ç **çš„ï¼Œéœ€è¦æ‰‹åŠ¨ä¿®æ”¹
- ç¡®ä¿è¦è¯„ä¼°çš„æ¨¡å‹æ–‡ä»¶å­˜åœ¨äº `data/models/` ç›®å½•
- ä½¿ç”¨é”™è¯¯çš„é…ç½®æ–‡ä»¶ä¼šå¯¼è‡´ `FileNotFoundError`

---

### æ–¹æ³•1: è¯„ä¼°CNN-PSæ¨¡å‹

#### 1ï¸âƒ£ æ£€æŸ¥å’Œä¿®æ”¹æ¨¡å‹è·¯å¾„

```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS

# æŸ¥çœ‹å¯ç”¨çš„CNN-PSæ¨¡å‹
ls -lh data/models/ev_cnn_ps_*.bin

# ç¼–è¾‘è¯„ä¼°è„šæœ¬ï¼Œä¿®æ”¹æ¨¡å‹è·¯å¾„
nano python/cnn_ps_eval.py

# æ‰¾åˆ°ç¬¬88è¡Œå·¦å³ï¼Œä¿®æ”¹ä¸ºä½ æƒ³è¯„ä¼°çš„æ¨¡å‹ï¼š
# NET.load_state_dict(torch.load("data/models/ev_cnn_ps_official_download.bin")["model_state_dict"])
```

**å¸¸ç”¨CNN-PSæ¨¡å‹**:
- `ev_cnn_ps_official_download.bin` - å®˜æ–¹é¢„è®­ç»ƒæ¨¡å‹ï¼ˆæ¨èï¼‰
- `ev_cnn_ps_019500.bin` - 19500æ¬¡è¿­ä»£ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- `ev_cnn_ps_020000.bin` - 20000æ¬¡è¿­ä»£ï¼ˆå¦‚æœå­˜åœ¨ï¼‰

#### 2ï¸âƒ£ å•ä¸ªæ•°æ®é›†è¯„ä¼°

```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# è¯„ä¼°å•ä¸ªæ•°æ®é›†ï¼ˆä½¿ç”¨eval_cnn_ps.inié…ç½®ï¼‰
./target/release/event_ps_eval_python_gui data/diligent/000000/eval_cnn_ps.ini
```

**è¾“å‡ºç¤ºä¾‹**:
```
Loaded model: ev_cnn_ps_official_download.bin
GUI enabled: normal_gt_CNN, buffer_show_CNN, normal_pred_CNN-PS
BENCHMARK Event-LS-PS n_pixels 33785 ang_err_mean 10.986771
BENCHMARK Event-CNN-PS n_pixels 33785 ang_err_mean 10.160244
```

**GUIçª—å£è¯´æ˜**:
- `normal_gt` - çœŸå®æ³•çº¿ï¼ˆGround Truthï¼‰
- `buffer_show` - äº‹ä»¶ç´¯ç§¯ç¼“å†²åŒº
- `normal_pred` - CNN-PSé¢„æµ‹æ³•çº¿ â­

#### 3ï¸âƒ£ æ‰¹é‡è¯„ä¼°æ‰€æœ‰æ•°æ®é›†

```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# å‰å°æ‰¹é‡è¯„ä¼°ï¼ˆæ¨èï¼Œå¯çœ‹åˆ°å®æ—¶ç»“æœï¼‰
for dir in data/diligent/*/; do
    echo "è¯„ä¼° $dir"
    ./target/release/event_ps_eval_python_gui ${dir}eval_cnn_ps.ini
    echo "âœ“ $dir å®Œæˆ"
done

# æˆ–è€…åå°æ‰¹é‡è¯„ä¼°
nohup bash -c "
source venv/bin/activate
for dir in data/diligent/*/; do
    echo \"Evaluating \$dir...\"
    ./target/release/event_ps_eval_python_gui \${dir}eval_cnn_ps.ini
    echo \"âœ“ \$dir completed\"
done
" > eval_cnn_ps_all.log 2>&1 &

# ç›‘æ§åå°è¯„ä¼°è¿›åº¦
tail -f eval_cnn_ps_all.log
```

---

### æ–¹æ³•2: è¯„ä¼°PS-FCNæ¨¡å‹

#### 1ï¸âƒ£ æ£€æŸ¥å’Œä¿®æ”¹æ¨¡å‹è·¯å¾„

```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS

# æŸ¥çœ‹å¯ç”¨çš„PS-FCNæ¨¡å‹
ls -lht data/models/ev_ps_fcn_*.bin | head -10

# ç¼–è¾‘è¯„ä¼°è„šæœ¬ï¼Œä¿®æ”¹æ¨¡å‹è·¯å¾„
nano python/ps_fcn_eval.py

# æ‰¾åˆ°ç¬¬78è¡Œå·¦å³ï¼Œä¿®æ”¹ä¸ºä½ æƒ³è¯„ä¼°çš„æ¨¡å‹ï¼š
# NET.load_state_dict(torch.load("data/models/ev_ps_fcn_020000.bin")["model_state_dict"])
```

**å¸¸ç”¨PS-FCNæ¨¡å‹**:
- `ev_ps_fcn_020000.bin` - 20000æ¬¡è¿­ä»£ï¼ˆæœ€æ–°è®­ç»ƒï¼‰
- `ev_ps_fcn_018000.bin` - 18000æ¬¡è¿­ä»£
- `ev_ps_fcn_016000.bin` - 16000æ¬¡è¿­ä»£
- `ev_ps_fcn_010000.bin` - 10000æ¬¡è¿­ä»£
- `ev_ps_fcn_006000.bin` - 6000æ¬¡è¿­ä»£

**ğŸ’¡ æç¤º**: é€šå¸¸è¿­ä»£æ¬¡æ•°è¶Šå¤šï¼Œæ€§èƒ½è¶Šå¥½ï¼Œä½†å»ºè®®å¯¹æ¯”å¤šä¸ªcheckpointæ‰¾åˆ°æœ€ä½³æ¨¡å‹ã€‚

#### 2ï¸âƒ£ å•ä¸ªæ•°æ®é›†è¯„ä¼°

```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# è¯„ä¼°å•ä¸ªæ•°æ®é›†ï¼ˆä½¿ç”¨eval_ps_fcn.inié…ç½®ï¼‰
./target/release/event_ps_eval_python_gui data/diligent/000000/eval_ps_fcn.ini
```

**âš ï¸ æ³¨æ„**: å¿…é¡»ä½¿ç”¨ `eval_ps_fcn.ini`ï¼Œä¸æ˜¯ `eval_cnn_ps.ini`ï¼

**è¾“å‡ºç¤ºä¾‹**:
```
Loaded model: ev_ps_fcn_020000.bin
BENCHMARK Event-LS-PS n_pixels 33785 ang_err_mean 10.986771
BENCHMARK Event-PS-FCN n_pixels 33785 ang_err_mean 12.345678
```

#### 3ï¸âƒ£ æ‰¹é‡è¯„ä¼°æ‰€æœ‰æ•°æ®é›†

```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# å‰å°æ‰¹é‡è¯„ä¼°
for dir in data/diligent/*/; do
    echo "è¯„ä¼° PS-FCN: $dir"
    ./target/release/event_ps_eval_python_gui ${dir}eval_ps_fcn.ini
    echo "âœ“ $dir å®Œæˆ"
done

# æˆ–è€…åå°æ‰¹é‡è¯„ä¼°
nohup bash -c "
source venv/bin/activate
for dir in data/diligent/*/; do
    echo \"Evaluating PS-FCN: \$dir...\"
    ./target/release/event_ps_eval_python_gui \${dir}eval_ps_fcn.ini
    echo \"âœ“ \$dir completed\"
done
" > eval_ps_fcn_all.log 2>&1 &

# ç›‘æ§åå°è¯„ä¼°è¿›åº¦
tail -f eval_ps_fcn_all.log
```

---

### é…ç½®æ–‡ä»¶è¯¦è§£

#### CNN-PSè¯„ä¼°é…ç½® (`eval_cnn_ps.ini`)

```ini
[ps]
scan_pattern = diligent
ps_fcn_per_n_bin = 0          # âŒ ç¦ç”¨PS-FCN
cnn_ps_per_n_bin = 1          # âœ… å¯ç”¨CNN-PS
cnn_ps_python = python/cnn_ps_eval.py
show_ls_ps = none             # å…³é—­Rustç«¯GUIï¼Œä½¿ç”¨Python GUI
```

**åŠŸèƒ½**: 
- è°ƒç”¨ `python/cnn_ps_eval.py` è„šæœ¬
- åŠ è½½ CNN-PS æ¨¡å‹è¿›è¡Œè¯„ä¼°
- Pythonç«¯æ˜¾ç¤ºGUIçª—å£

#### PS-FCNè¯„ä¼°é…ç½® (`eval_ps_fcn.ini`)

```ini
[ps]
scan_pattern = diligent
ps_fcn_per_n_bin = 1          # âœ… å¯ç”¨PS-FCN
cnn_ps_per_n_bin = 0          # âŒ ç¦ç”¨CNN-PS
ps_fcn_python = python/ps_fcn_eval.py
show_ls_ps = none             # å…³é—­Rustç«¯GUIï¼Œä½¿ç”¨Python GUI
```

**åŠŸèƒ½**:
- è°ƒç”¨ `python/ps_fcn_eval.py` è„šæœ¬
- åŠ è½½ PS-FCN æ¨¡å‹è¿›è¡Œè¯„ä¼°
- Pythonç«¯æ˜¾ç¤ºGUIçª—å£

---

### å¯¹æ¯”è¯„ä¼°å¤šä¸ªæ¨¡å‹

å¦‚æœæƒ³å¯¹æ¯”ä¸åŒcheckpointçš„æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨å¾ªç¯è¯„ä¼°ï¼š

```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# å¯¹æ¯”PS-FCNä¸åŒè¿­ä»£æ¬¡æ•°çš„æ¨¡å‹
for model in data/models/ev_ps_fcn_{010000,012000,014000,016000,018000,020000}.bin; do
    if [ -f "$model" ]; then
        echo "========================================="
        echo "è¯„ä¼°æ¨¡å‹: $model"
        echo "========================================="
        
        # ä¿®æ”¹è¯„ä¼°è„šæœ¬ä¸­çš„æ¨¡å‹è·¯å¾„
        sed -i "s|torch.load(\"data/models/ev_ps_fcn_[0-9]*.bin\")|torch.load(\"$model\")|" python/ps_fcn_eval.py
        
        # è¯„ä¼°å•ä¸ªæ•°æ®é›†
        ./target/release/event_ps_eval_python_gui data/diligent/000000/eval_ps_fcn.ini
        
        echo ""
    fi
done
```

---

### ç»„ç»‡å’Œä¿å­˜è¯„ä¼°ç»“æœ

å»ºè®®ä¸ºæ¯æ¬¡è¯„ä¼°åˆ›å»ºç‹¬ç«‹çš„æŠ¥å‘Šç›®å½•ï¼Œä¾¿äºç®¡ç†å’Œå¯¹æ¯”ä¸åŒç‰ˆæœ¬çš„æ¨¡å‹ï¼š

#### è¯„ä¼°CNN-PSæ¨¡å‹å¹¶ä¿å­˜æŠ¥å‘Š

```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# åˆ›å»ºå¸¦æ—¥æœŸçš„CNN-PSè¯„ä¼°æŠ¥å‘Šç›®å½•
REPORT_DIR="eval_report/cnn_report_$(date +%Y%m%d_%H%M%S)"
mkdir -p "$REPORT_DIR"

# æ‰¹é‡è¯„ä¼°CNN-PSå¹¶ä¿å­˜æ—¥å¿—
nohup bash -c "
source venv/bin/activate
for dir in data/diligent/*/; do
    echo \"Evaluating \$dir...\"
    ./target/release/event_ps_eval_python_gui \${dir}eval_cnn_ps.ini
    echo \"âœ“ \$dir completed\"
done
" > "${REPORT_DIR}/eval_log.txt" 2>&1 &

# ç›‘æ§è¯„ä¼°è¿›åº¦
tail -f "${REPORT_DIR}/eval_log.txt"

# ç­‰å¾…è¯„ä¼°å®Œæˆåï¼Œç”Ÿæˆæ±‡æ€»æŠ¥å‘Š
python python/benchmark_gather_result.py "${REPORT_DIR}/eval_log.txt" > "${REPORT_DIR}/summary.txt"

# æŸ¥çœ‹æ±‡æ€»ç»“æœ
cat "${REPORT_DIR}/summary.txt"

# å¦‚æœéœ€è¦ç”Ÿæˆå®Œæ•´å›¾è¡¨æŠ¥å‘Šï¼Œä¿®æ”¹å¹¶è¿è¡Œ
sed -i "s/eval_all_diligent_019500_working.log/${REPORT_DIR//\//\\/}\/eval_log.txt/" generate_evaluation_report.py
python3 generate_evaluation_report.py
cp evaluation_results_diligent.* "$REPORT_DIR/" 2>/dev/null

# æŸ¥çœ‹æŠ¥å‘Šç›®å½•
ls -lh "$REPORT_DIR/"
```

#### è¯„ä¼°PS-FCNæ¨¡å‹å¹¶ä¿å­˜æŠ¥å‘Š

```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# åˆ›å»ºå¸¦æ—¥æœŸçš„PS-FCNè¯„ä¼°æŠ¥å‘Šç›®å½•
REPORT_DIR="eval_report/fcn_report_$(date +%Y%m%d_%H%M%S)"
mkdir -p "$REPORT_DIR"

# æ‰¹é‡è¯„ä¼°PS-FCNå¹¶ä¿å­˜æ—¥å¿—ï¼ˆæ³¨æ„ï¼šä½¿ç”¨ eval_ps_fcn.iniï¼‰
nohup bash -c "
source venv/bin/activate
for dir in data/diligent/*/; do
    echo \"Evaluating \$dir...\"
    ./target/release/event_ps_eval_python_gui \${dir}eval_ps_fcn.ini
    echo \"âœ“ \$dir completed\"
done
" > "${REPORT_DIR}/eval_log.txt" 2>&1 &

# ç›‘æ§è¯„ä¼°è¿›åº¦
tail -f "${REPORT_DIR}/eval_log.txt"

# ç­‰å¾…è¯„ä¼°å®Œæˆåï¼Œç”Ÿæˆæ±‡æ€»æŠ¥å‘Š
python python/benchmark_gather_result.py "${REPORT_DIR}/eval_log.txt" > "${REPORT_DIR}/summary.txt"

# æŸ¥çœ‹æ±‡æ€»ç»“æœ
cat "${REPORT_DIR}/summary.txt"

# å¦‚æœéœ€è¦ç”Ÿæˆå®Œæ•´å›¾è¡¨æŠ¥å‘Š
sed -i "s/eval_all_diligent_019500_working.log/${REPORT_DIR//\//\\/}\/eval_log.txt/" generate_evaluation_report.py
python3 generate_evaluation_report.py
cp evaluation_results_diligent.* "$REPORT_DIR/" 2>/dev/null

# æŸ¥çœ‹æŠ¥å‘Šç›®å½•
ls -lh "$REPORT_DIR/"
```

**å…³é”®åŒºåˆ«**:
- CNN-PS: ä½¿ç”¨ `eval_cnn_ps.ini` é…ç½®æ–‡ä»¶
- PS-FCN: ä½¿ç”¨ `eval_ps_fcn.ini` é…ç½®æ–‡ä»¶ âš ï¸

**ç”Ÿæˆçš„ç›®å½•ç»“æ„ç¤ºä¾‹**:
```
eval_report/
â”œâ”€â”€ cnn_report_20251104_160000/
â”‚   â”œâ”€â”€ eval_log.txt                    # å®Œæ•´è¯„ä¼°æ—¥å¿—
â”‚   â”œâ”€â”€ summary.txt                     # æ±‡æ€»ç»“æœ
â”‚   â”œâ”€â”€ evaluation_results_diligent.csv # CSVæ•°æ®è¡¨
â”‚   â”œâ”€â”€ evaluation_results_diligent.txt # æ–‡æœ¬æŠ¥å‘Š
â”‚   â”œâ”€â”€ evaluation_results_diligent.png # ç»¼åˆåˆ†æå›¾
â”‚   â””â”€â”€ evaluation_comparison_simple.png # ç®€æ´å¯¹æ¯”å›¾
â”œâ”€â”€ fcn_report_20251104_170000/
â”‚   â”œâ”€â”€ eval_log.txt                    # PS-FCNè¯„ä¼°æ—¥å¿—
â”‚   â”œâ”€â”€ summary.txt                     # PS-FCNæ±‡æ€»ç»“æœ
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

---

### æ”¶é›†å’Œæ±‡æ€»è¯„ä¼°ç»“æœ

è¯„ä¼°å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·è„šæœ¬ä»æ—¥å¿—ä¸­æå–ç»“æœå¹¶ç”Ÿæˆç»Ÿè®¡æŠ¥å‘Šã€‚

#### æ–¹æ³•1: ä½¿ç”¨ benchmark_gather_result.pyï¼ˆå¿«é€Ÿæ±‡æ€»ï¼‰

è¿™æ˜¯ä¸€ä¸ªè½»é‡çº§å·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿä»è¯„ä¼°æ—¥å¿—ä¸­æå–å¹³å‡è¯¯å·®ã€‚

```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# ä»æ—¥å¿—æ–‡ä»¶ä¸­æå–CNN-PSè¯„ä¼°ç»“æœ
python python/benchmark_gather_result.py eval_cnn_ps_all.log

# æˆ–ä»æ ‡å‡†è¾“å…¥è¯»å–
cat eval_cnn_ps_all.log | python python/benchmark_gather_result.py

# ä»æ—¥å¿—æ–‡ä»¶ä¸­æå–PS-FCNè¯„ä¼°ç»“æœ
python python/benchmark_gather_result.py eval_ps_fcn_all.log
```

**è¾“å‡ºç¤ºä¾‹**:
```python
{
    'Event-LS-PS': {'n_pixel': 216637, 'ang_err': 19.73},
    'Event-CNN-PS': {'n_pixel': 216637, 'ang_err': 15.63}
}
```

**è¾“å‡ºå­—æ®µè¯´æ˜**:
- `n_pixel`: æ‰€æœ‰æ•°æ®é›†çš„æ€»åƒç´ æ•°
- `ang_err`: åŠ æƒå¹³å‡è§’åº¦è¯¯å·®ï¼ˆåº¦ï¼‰

---

#### æ–¹æ³•2: ç”Ÿæˆå®Œæ•´è¯„ä¼°æŠ¥å‘Šï¼ˆæ¨èï¼‰â­

ä½¿ç”¨ `generate_evaluation_report.py` ç”ŸæˆåŒ…å«å›¾è¡¨å’Œç»Ÿè®¡åˆ†æçš„å®Œæ•´æŠ¥å‘Šã€‚

##### æ­¥éª¤1: å‡†å¤‡è¯„ä¼°æ—¥å¿—

é¦–å…ˆç¡®ä¿å·²ç»å®Œæˆæ‰¹é‡è¯„ä¼°å¹¶ä¿å­˜äº†æ—¥å¿—æ–‡ä»¶ï¼š

```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# å¦‚æœè¿˜æ²¡æœ‰è¯„ä¼°ï¼Œå…ˆè¿è¡Œæ‰¹é‡è¯„ä¼°
nohup bash -c "
source venv/bin/activate
for dir in data/diligent/*/; do
    echo \"Evaluating \$dir...\"
    ./target/release/event_ps_eval_python_gui \${dir}eval_cnn_ps.ini
    echo \"âœ“ \$dir completed\"
done
" > eval_all_diligent_cnn.log 2>&1 &

# ç­‰å¾…è¯„ä¼°å®Œæˆï¼Œå¯ä»¥ç”¨ tail -f ç›‘æ§
tail -f eval_all_diligent_cnn.log
```

##### æ­¥éª¤2: ä¿®æ”¹æŠ¥å‘Šç”Ÿæˆè„šæœ¬

ç¼–è¾‘ `generate_evaluation_report.py`ï¼ŒæŒ‡å®šæ­£ç¡®çš„æ—¥å¿—æ–‡ä»¶ï¼š

```bash
nano generate_evaluation_report.py

# æ‰¾åˆ°ç¬¬12è¡Œå·¦å³ï¼Œä¿®æ”¹æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼š
# with open('eval_all_diligent_cnn.log', 'r') as f:
```

**æˆ–è€…ä½¿ç”¨ sed å¿«é€Ÿä¿®æ”¹**:
```bash
# å¤‡ä»½åŸè„šæœ¬
cp generate_evaluation_report.py generate_evaluation_report.py.bak

# ä¿®æ”¹æ—¥å¿—æ–‡ä»¶è·¯å¾„
sed -i "s/eval_all_diligent_019500_working.log/eval_all_diligent_cnn.log/" generate_evaluation_report.py
```

##### æ­¥éª¤3: ç”ŸæˆæŠ¥å‘Š

```bash
# è¿è¡ŒæŠ¥å‘Šç”Ÿæˆè„šæœ¬
python3 generate_evaluation_report.py

# å¦‚æœé‡åˆ°æ¨¡å—ç¼ºå¤±é”™è¯¯ï¼Œå®‰è£…ä¾èµ–
pip install pandas matplotlib
```

##### æ­¥éª¤4: æŸ¥çœ‹ç”Ÿæˆçš„æŠ¥å‘Šæ–‡ä»¶

```bash
# æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶
ls -lh evaluation_results_diligent.*

# é¢„æœŸç”Ÿæˆçš„æ–‡ä»¶ï¼š
# - evaluation_results_diligent.csv      # CSVæ•°æ®è¡¨æ ¼
# - evaluation_results_diligent.txt      # æ–‡æœ¬æ ¼å¼æŠ¥å‘Š
# - evaluation_results_diligent.png      # ç»¼åˆåˆ†æå›¾ï¼ˆ4åˆ1ï¼‰
# - evaluation_comparison_simple.png     # ç®€æ´æŸ±çŠ¶å¯¹æ¯”å›¾
```

**æŸ¥çœ‹æ–‡æœ¬æŠ¥å‘Š**:
```bash
cat evaluation_results_diligent.txt
```

**æŸ¥çœ‹CSVæ•°æ®**:
```bash
cat evaluation_results_diligent.csv
# æˆ–ç”¨è¡¨æ ¼å·¥å…·æ‰“å¼€
libreoffice evaluation_results_diligent.csv
```

**æŸ¥çœ‹å›¾è¡¨**:
```bash
# ä½¿ç”¨å›¾ç‰‡æŸ¥çœ‹å™¨
eog evaluation_results_diligent.png
eog evaluation_comparison_simple.png

# æˆ–åœ¨GUIæ–‡ä»¶ç®¡ç†å™¨ä¸­æ‰“å¼€
nautilus . &
```

---

### è¯„ä¼°æŠ¥å‘Šå†…å®¹è¯´æ˜

ç”Ÿæˆçš„è¯„ä¼°æŠ¥å‘ŠåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

#### 1. CSVæ•°æ®è¡¨æ ¼ (`evaluation_results_diligent.csv`)

åŒ…å«æ¯ä¸ªæ•°æ®é›†çš„è¯¦ç»†æŒ‡æ ‡ï¼š

| Dataset ID | Dataset Name | Pixels | LS-PS Error | CNN-PS Error | Improvement | Improvement % |
|-----------|--------------|--------|-------------|--------------|-------------|---------------|
| 000000 | Ball | 33785 | 10.99Â° | 10.16Â° | 0.83Â° | 7.52% |
| 000002 | Bear | 21589 | 18.73Â° | 16.45Â° | 2.28Â° | 12.14% |
| ... | ... | ... | ... | ... | ... | ... |

#### 2. æ–‡æœ¬æ ¼å¼æŠ¥å‘Š (`evaluation_results_diligent.txt`)

åŒ…å«ï¼š
- æ¯ä¸ªæ•°æ®é›†çš„è¯¦ç»†ç»“æœ
- å¹³å‡è¯¯å·®ç»Ÿè®¡
- æ€§èƒ½æå‡ç™¾åˆ†æ¯”
- æœ€ä½³/æœ€å·®è¡¨ç°çš„æ•°æ®é›†

#### 3. ç»¼åˆåˆ†æå›¾ (`evaluation_results_diligent.png`)

4åˆ1å¯è§†åŒ–å›¾è¡¨ï¼š
- **å·¦ä¸Š**: é€æ•°æ®é›†è¯¯å·®å¯¹æ¯”æŸ±çŠ¶å›¾
- **å³ä¸Š**: è¯¯å·®æ”¹å–„ç™¾åˆ†æ¯”æŸ±çŠ¶å›¾
- **å·¦ä¸‹**: è¯¯å·®å¯¹æ¯”æ•£ç‚¹å›¾
- **å³ä¸‹**: ç»Ÿè®¡æ‘˜è¦è¡¨æ ¼

#### 4. ç®€æ´å¯¹æ¯”å›¾ (`evaluation_comparison_simple.png`)

æ¸…æ™°çš„æŸ±çŠ¶å›¾ï¼Œå¯¹æ¯” LS-PS å’Œ CNN-PS/PS-FCN åœ¨å„æ•°æ®é›†ä¸Šçš„è¡¨ç°ã€‚

---

### è¯„ä¼°æŠ¥å‘Šç”Ÿæˆå¸¸è§é—®é¢˜

#### âŒ é—®é¢˜1: ModuleNotFoundError: No module named 'pandas'

**è§£å†³æ–¹æ¡ˆ**:
```bash
source venv/bin/activate
pip install pandas matplotlib numpy
```

#### âŒ é—®é¢˜2: æŠ¥å‘Šè„šæœ¬æ‰¾ä¸åˆ°æ—¥å¿—æ–‡ä»¶

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -lh eval_*.log

# ä¿®æ”¹æŠ¥å‘Šè„šæœ¬ä¸­çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„
nano generate_evaluation_report.py
# ç¡®ä¿ç¬¬12è¡ŒæŒ‡å‘æ­£ç¡®çš„æ—¥å¿—æ–‡ä»¶
```

#### âŒ é—®é¢˜3: æŠ¥å‘Šä¸­æ•°æ®ç¼ºå¤±æˆ–ä¸å®Œæ•´

**åŸå› **: è¯„ä¼°æ—¥å¿—ä¸å®Œæ•´æˆ–æ ¼å¼ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥æ—¥å¿—æ–‡ä»¶å†…å®¹
cat eval_all_diligent_cnn.log | grep "BENCHMARK"

# ç¡®è®¤æ¯ä¸ªæ•°æ®é›†éƒ½æœ‰BENCHMARKè¾“å‡º
# å¦‚æœç¼ºå¤±ï¼Œé‡æ–°è¿è¡Œè¯„ä¼°
```

#### âŒ é—®é¢˜4: æ— æ³•æ˜¾ç¤ºå›¾è¡¨

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ç¡®è®¤X serveræ­£åœ¨è¿è¡Œ
echo $DISPLAY

# æˆ–å°†å›¾è¡¨ä¿å­˜è€Œä¸æ˜¾ç¤ºï¼ˆä¿®æ”¹è„šæœ¬ï¼‰
# plt.show() æ”¹ä¸º plt.savefig()
```

---

### å¿«é€Ÿè¯„ä¼°æŠ¥å‘Šç”Ÿæˆæµç¨‹ â­ æ¨è

å®Œæ•´çš„è¯„ä¼°å’ŒæŠ¥å‘Šç”Ÿæˆæµç¨‹ï¼ˆä¸€é”®å¼ï¼‰ï¼š

#### æ–¹æ³•1: ä¸€é”®è¯„ä¼°+æŠ¥å‘Šç”Ÿæˆï¼ˆæ¨èï¼‰â­

```bash
# === ç¯å¢ƒå‡†å¤‡ ===
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# === CNN-PSå®Œæ•´æµç¨‹ ===
# Step 1: æ‰¹é‡è¯„ä¼°å¹¶ä¿å­˜åˆ°logsç›®å½•
nohup bash -c "
source venv/bin/activate
for dir in data/diligent/*/; do
    echo \"Evaluating \$dir...\"
    ./target/release/event_ps_eval_python_gui \${dir}eval_cnn_ps.ini
    echo \"âœ“ \$dir completed\"
done
" > logs/eval_cnn_ps_$(date +%Y%m%d_%H%M%S).log 2>&1 &

# Step 2: ç›‘æ§è¯„ä¼°è¿›åº¦
tail -f logs/eval_cnn_ps_*.log

# Step 3: ç­‰å¾…è¯„ä¼°å®Œæˆï¼Œæ£€æŸ¥æ•°é‡
grep "completed" logs/eval_cnn_ps_*.log | wc -l  # åº”è¯¥æ˜¯9

# Step 4: ä¸€é”®ç”Ÿæˆå®Œæ•´æŠ¥å‘Šï¼ˆè‡ªåŠ¨åˆ›å»ºå¸¦æ—¥æœŸçš„ç›®å½•ï¼‰
python3 generate_evaluation_report.py logs/eval_cnn_ps_20251104_175245.log

# è¾“å‡ºç¤ºä¾‹:
# ================================================================================
# EventPS è¯„ä¼°æŠ¥å‘Šç”Ÿæˆå™¨
# ================================================================================
# æ—¥å¿—æ–‡ä»¶: logs/eval_cnn_ps_20251104_175245.log
# è¾“å‡ºç›®å½•: eval_report/cnn_report_20251104_180530
# ================================================================================
# âœ“ æ£€æµ‹åˆ°æ¨¡å‹ç±»å‹: CNN-PS
# âœ“ æˆåŠŸæå– 9 ä¸ªæ•°æ®é›†çš„è¯„ä¼°ç»“æœ
# âœ“ æŠ¥å‘Šç”Ÿæˆå®Œæˆï¼

# === PS-FCNå®Œæ•´æµç¨‹ ===
# Step 1: æ‰¹é‡è¯„ä¼°å¹¶ä¿å­˜åˆ°logsç›®å½•
nohup bash -c "
source venv/bin/activate
for dir in data/diligent/*/; do
    echo \"Evaluating \$dir...\"
    ./target/release/event_ps_eval_python_gui \${dir}eval_ps_fcn.ini
    echo \"âœ“ \$dir completed\"
done
" > logs/eval_ps_fcn_$(date +%Y%m%d_%H%M%S).log 2>&1 &

# Step 2: ç›‘æ§è¯„ä¼°è¿›åº¦
tail -f logs/eval_ps_fcn_*.log

# Step 3: ç­‰å¾…è¯„ä¼°å®Œæˆåï¼Œä¸€é”®ç”ŸæˆæŠ¥å‘Š
python3 generate_evaluation_report.py logs/eval_ps_fcn_20251104_091804.log

# æŸ¥çœ‹ç”Ÿæˆçš„æŠ¥å‘Š
ls -lh eval_report/fcn_report_*/
cat eval_report/fcn_report_*/evaluation_results_diligent.txt
```

**generate_evaluation_report.py ç‰¹æ€§**:
- âœ… è‡ªåŠ¨æ£€æµ‹æ¨¡å‹ç±»å‹ï¼ˆCNN-PSæˆ–PS-FCNï¼‰
- âœ… è‡ªåŠ¨åˆ›å»ºå¸¦æ—¶é—´æˆ³çš„è¾“å‡ºç›®å½•
- âœ… ç”Ÿæˆ4ç§æŠ¥å‘Šæ–‡ä»¶ï¼ˆCSVã€TXTã€2ä¸ªPNGå›¾ï¼‰
- âœ… è‡ªåŠ¨å¤åˆ¶æ—¥å¿—æ–‡ä»¶åˆ°æŠ¥å‘Šç›®å½•
- âœ… æ˜¾ç¤ºè¯¦ç»†çš„ç”Ÿæˆè¿›åº¦å’Œç»“æœæ‘˜è¦

**ç”Ÿæˆçš„ç›®å½•ç»“æ„**:
```
eval_report/
â”œâ”€â”€ cnn_report_20251104_180530/          # è‡ªåŠ¨åˆ›å»ºçš„CNN-PSæŠ¥å‘Šç›®å½•
â”‚   â”œâ”€â”€ evaluation_results_diligent.csv  # CSVæ•°æ®è¡¨
â”‚   â”œâ”€â”€ evaluation_results_diligent.txt  # æ–‡æœ¬æŠ¥å‘Š
â”‚   â”œâ”€â”€ evaluation_results_diligent.png  # ç»¼åˆåˆ†æå›¾ï¼ˆ4åˆ1ï¼‰
â”‚   â”œâ”€â”€ evaluation_comparison_simple.png # ç®€æ´å¯¹æ¯”å›¾
â”‚   â””â”€â”€ eval_cnn_ps_20251104_175245.log  # è¯„ä¼°æ—¥å¿—å‰¯æœ¬
â”œâ”€â”€ fcn_report_20251104_175245/          # è‡ªåŠ¨åˆ›å»ºçš„PS-FCNæŠ¥å‘Šç›®å½•
â”‚   â”œâ”€â”€ evaluation_results_diligent.csv
â”‚   â”œâ”€â”€ evaluation_results_diligent.txt
â”‚   â”œâ”€â”€ evaluation_results_diligent.png
â”‚   â”œâ”€â”€ evaluation_comparison_simple.png
â”‚   â””â”€â”€ eval_ps_fcn_20251104_091804.log
â””â”€â”€ ...
```

---

#### æ–¹æ³•2: æ‰‹åŠ¨æµç¨‹ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰

```bash
# === Step 1: ç¯å¢ƒå‡†å¤‡ ===
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# === Step 2: æ‰¹é‡è¯„ä¼° ===
# CNN-PSè¯„ä¼°
nohup bash -c "
source venv/bin/activate
for dir in data/diligent/*/; do
    ./target/release/event_ps_eval_python_gui \${dir}eval_cnn_ps.ini
done
" > eval_all_cnn.log 2>&1 &

# PS-FCNè¯„ä¼°
nohup bash -c "
source venv/bin/activate
for dir in data/diligent/*/; do
    ./target/release/event_ps_eval_python_gui \${dir}eval_ps_fcn.ini
done
" > eval_all_fcn.log 2>&1 &

# === Step 3: ç­‰å¾…è¯„ä¼°å®Œæˆ ===
# ç›‘æ§è¿›åº¦
tail -f eval_all_cnn.log
# æ£€æŸ¥æ˜¯å¦å®Œæˆ
grep "completed" eval_all_cnn.log | wc -l  # åº”è¯¥æ˜¯9

# === Step 4: å¿«é€Ÿæ±‡æ€»ç»“æœ ===
python python/benchmark_gather_result.py eval_all_cnn.log
python python/benchmark_gather_result.py eval_all_fcn.log

# === Step 5: ç”Ÿæˆå®Œæ•´æŠ¥å‘Š ===
python3 generate_evaluation_report.py eval_all_cnn.log

# === Step 6: æŸ¥çœ‹æŠ¥å‘Š ===
cat eval_report/cnn_report_*/evaluation_results_diligent.txt
eog eval_report/cnn_report_*/evaluation_results_diligent.png
```

---

### è¯„ä¼°å¸¸è§é—®é¢˜

#### âŒ é—®é¢˜1: FileNotFoundError: 'data/models/ev_cnn_ps_019500.bin'

**åŸå› **: è¯„ä¼°è„šæœ¬ä¸­æŒ‡å®šçš„æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥å®é™…å­˜åœ¨çš„æ¨¡å‹
ls -lh data/models/ev_cnn_ps_*.bin

# 2. ç¼–è¾‘è¯„ä¼°è„šæœ¬ï¼Œä¿®æ”¹ä¸ºå­˜åœ¨çš„æ¨¡å‹
nano python/cnn_ps_eval.py

# 3. ä¿®æ”¹ç¬¬88è¡Œä¸ºå®é™…å­˜åœ¨çš„æ¨¡å‹è·¯å¾„
# NET.load_state_dict(torch.load("data/models/ev_cnn_ps_official_download.bin")["model_state_dict"])
```

#### âŒ é—®é¢˜2: è¿è¡Œeval_ps_fcn.iniå´è°ƒç”¨äº†cnn_ps_eval.py

**åŸå› **: ä½¿ç”¨äº†é”™è¯¯çš„é…ç½®æ–‡ä»¶

**è§£å†³æ–¹æ¡ˆ**:
```bash
# âŒ é”™è¯¯ï¼šä½¿ç”¨äº†eval_cnn_ps.ini
./target/release/event_ps_eval_python_gui data/diligent/000000/eval_cnn_ps.ini

# âœ… æ­£ç¡®ï¼šä½¿ç”¨eval_ps_fcn.ini
./target/release/event_ps_eval_python_gui data/diligent/000000/eval_ps_fcn.ini
```

#### âŒ é—®é¢˜3: è¯„ä¼°æ—¶æ²¡æœ‰GUIæ˜¾ç¤º

**æ£€æŸ¥é¡¹**:
1. ç¡®è®¤ä½¿ç”¨äº† `event_ps_eval_python_gui` å¯æ‰§è¡Œæ–‡ä»¶
2. ç¡®è®¤DISPLAYç¯å¢ƒå˜é‡: `echo $DISPLAY`
3. ç¡®è®¤Pythonè„šæœ¬ä¸­æ²¡æœ‰æ³¨é‡Šæ‰ `cv.imshow()` å’Œ `cv.waitKey(1)`
4. ç¡®è®¤é…ç½®æ–‡ä»¶ä¸­ `show_ls_ps = none`

#### âŒ é—®é¢˜4: è¯„ä¼°ç»“æœä¸é¢„æœŸä¸ç¬¦

**å¯èƒ½åŸå› **:
- ä½¿ç”¨äº†é”™è¯¯çš„æ¨¡å‹æ–‡ä»¶
- è¯„ä¼°è„šæœ¬åŠ è½½äº†æ—§çš„æ¨¡å‹
- æ¨¡å‹è®­ç»ƒä¸å……åˆ†

**éªŒè¯æ–¹æ³•**:
```bash
# æŸ¥çœ‹è¯„ä¼°è„šæœ¬ä¸­å®é™…åŠ è½½çš„æ¨¡å‹
grep "torch.load" python/cnn_ps_eval.py
grep "torch.load" python/ps_fcn_eval.py

# æŸ¥çœ‹æ¨¡å‹æ–‡ä»¶æ˜¯å¦å®Œæ•´
ls -lh data/models/ev_*_*.bin
```

---

### å¿«é€Ÿè¯„ä¼°å‘½ä»¤å‚è€ƒ

```bash
# === ç¯å¢ƒå‡†å¤‡ ===
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# === æŸ¥çœ‹å¯ç”¨æ¨¡å‹ ===
ls -lh data/models/ev_cnn_ps_*.bin      # CNN-PSæ¨¡å‹
ls -lht data/models/ev_ps_fcn_*.bin     # PS-FCNæ¨¡å‹ï¼ˆæŒ‰æ—¶é—´æ’åºï¼‰

# === ä¿®æ”¹è¯„ä¼°æ¨¡å‹ ===
nano python/cnn_ps_eval.py    # ä¿®æ”¹ç¬¬88è¡Œ
nano python/ps_fcn_eval.py    # ä¿®æ”¹ç¬¬78è¡Œ

# === å•ä¸ªæ•°æ®é›†è¯„ä¼° ===
./target/release/event_ps_eval_python_gui data/diligent/000000/eval_cnn_ps.ini   # CNN-PS
./target/release/event_ps_eval_python_gui data/diligent/000000/eval_ps_fcn.ini   # PS-FCN

# === æ‰¹é‡è¯„ä¼°ï¼ˆå‰å°ï¼‰ ===
for dir in data/diligent/*/; do ./target/release/event_ps_eval_python_gui ${dir}eval_cnn_ps.ini; done
for dir in data/diligent/*/; do ./target/release/event_ps_eval_python_gui ${dir}eval_ps_fcn.ini; done

# === æ‰¹é‡è¯„ä¼°ï¼ˆåå°ï¼‰ ===
nohup bash -c "for dir in data/diligent/*/; do ./target/release/event_ps_eval_python_gui \${dir}eval_cnn_ps.ini; done" > eval_cnn.log 2>&1 &
nohup bash -c "for dir in data/diligent/*/; do ./target/release/event_ps_eval_python_gui \${dir}eval_ps_fcn.ini; done" > eval_fcn.log 2>&1 &
```

---

## è®­ç»ƒæ“ä½œ

EventPSæ”¯æŒä¸¤ç§æ·±åº¦å­¦ä¹ æ¨¡å‹çš„è®­ç»ƒï¼š**CNN-PS** å’Œ **PS-FCN**ã€‚

### æ¨¡å‹å¯¹æ¯”

| ç‰¹æ€§ | CNN-PS | PS-FCN |
|------|--------|--------|
| **ç½‘ç»œç»“æ„** | è½»é‡çº§CNN | å…¨å·ç§¯ç½‘ç»œ(FCN) |
| **è®­ç»ƒéš¾åº¦** | â­ ç®€å• | â­â­â­ å¤æ‚ |
| **é¢„è®­ç»ƒæ¨¡å‹** | âœ… ä¸éœ€è¦ | âš ï¸ éœ€è¦ PS-FCN_B_S_32.pth.tar |
| **è®­ç»ƒç¨³å®šæ€§** | âœ… ç¨³å®š | âš ï¸ å®¹æ˜“å´©æºƒï¼ˆLibreDRé—®é¢˜ï¼‰ |
| **è®­ç»ƒé€Ÿåº¦** | å¿« | è¾ƒæ…¢ |
| **ä¿å­˜é¢‘ç‡** | æ¯500æ¬¡ | æ¯3000æ¬¡ |
| **å»ºè®®è¿­ä»£** | 20000æ¬¡ | 10000æ¬¡ |
| **æ€§èƒ½** | **â­ æœ€ä½³** (15.63Â°) | ä¸€èˆ¬ (20.85Â°) |

**æ¨è**: ä¼˜å…ˆè®­ç»ƒCNN-PSæ¨¡å‹ï¼Œç®€å•ç¨³å®šä¸”æ€§èƒ½æœ€ä¼˜ã€‚

---

### è®­ç»ƒå‰å‡†å¤‡æ¸…å•

#### é€šç”¨å‡†å¤‡ï¼ˆä¸¤ç§æ¨¡å‹éƒ½éœ€è¦ï¼‰
```bash
# 1. ç¡®è®¤è™šæ‹Ÿç¯å¢ƒ
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# 2. ç¡®è®¤LibreDRæœåŠ¡è¿è¡Œ
ps aux | grep libredr_server
ps aux | grep libredr_worker

# 3. ç¡®è®¤è®­ç»ƒæ•°æ®å­˜åœ¨
ls -d data/blobs_training/*/
ls -d data/sculptures_training/*/

# 4. ç¡®è®¤GPUå¯ç”¨
nvidia-smi
```

#### CNN-PSç‰¹å®šå‡†å¤‡
```bash
# æ£€æŸ¥è®­ç»ƒè„šæœ¬
cat python/cnn_ps_train.py | grep "lr="

# æ— éœ€å…¶ä»–ç‰¹æ®Šå‡†å¤‡
```

#### PS-FCNç‰¹å®šå‡†å¤‡
```bash
# æ£€æŸ¥é¢„è®­ç»ƒæ¨¡å‹æ˜¯å¦å­˜åœ¨ï¼ˆå¿…é¡»ï¼ï¼‰
ls -lh python/ev_ps_fcn/PS-FCN/data/models/PS-FCN_B_S_32.pth.tar

# å¦‚æœä¸å­˜åœ¨ï¼Œå¿…é¡»å…ˆä¸‹è½½ï¼ˆå‚è§"æ•°æ®å‡†å¤‡"ç« èŠ‚ï¼‰
```

---

### æ–¹æ³•1: è®­ç»ƒCNN-PSæ¨¡å‹ â­ æ¨è

CNN-PSæ˜¯è½»é‡çº§æ¨¡å‹ï¼Œè®­ç»ƒç¨³å®šï¼Œæ€§èƒ½æœ€ä¼˜ã€‚

#### å‰å°è®­ç»ƒï¼ˆæ¨èï¼Œå¯å®æ—¶æŸ¥çœ‹ï¼‰

```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# å‰å°è®­ç»ƒï¼ˆå¸¦GUIå’Œå®æ—¶è¾“å‡ºï¼‰
CUDA_VISIBLE_DEVICES=0 DISPLAY=:1 PYTHONUNBUFFERED=1 ./target/release/event_ps_train \
    --cnn-ps-train python/cnn_ps_train.py \
    2>&1 | tee train_cnn_$(date +%Y%m%d_%H%M%S).log

# è¯´æ˜ï¼š
# - CUDA_VISIBLE_DEVICES=0  # æŒ‡å®šä½¿ç”¨GPU 0ï¼ˆé‡è¦ï¼ï¼‰
# - DISPLAY=:1              # æŒ‡å®šXæ˜¾ç¤ºï¼ˆå¦‚æœä½¿ç”¨VNCï¼‰
# - PYTHONUNBUFFERED        # å®æ—¶è¾“å‡ºï¼ˆä¸ç¼“å†²ï¼‰
# - tee                     # åŒæ—¶è¾“å‡ºåˆ°ç»ˆç«¯å’Œæ—¥å¿—æ–‡ä»¶
```

**è®­ç»ƒè¿‡ç¨‹è¾“å‡ºç¤ºä¾‹**:
```
iter 0 loss 0.8234
iter 1 loss 0.7892
iter 2 loss 0.7456
...
iter 500 loss 0.3456  # è‡ªåŠ¨ä¿å­˜æ¨¡å‹
iter 1000 loss 0.2987
...
iter 6000 loss 0.1234  # å­¦ä¹ ç‡è¡°å‡
...
```

**GUIçª—å£**:
- `normal_gt` - Ground Truthæ³•çº¿
- `buffer_show` - äº‹ä»¶ç¼“å†²åŒº
- `normal_pred` - CNNé¢„æµ‹ç»“æœ

**æŸ¥çœ‹è¿­ä»£å’Œlossï¼ˆå‰å°è®­ç»ƒï¼‰** â­:

å‰å°è®­ç»ƒæ—¶ï¼Œæ‰€æœ‰è¾“å‡ºä¼š**å®æ—¶æ˜¾ç¤ºåœ¨ç»ˆç«¯**ï¼ŒåŒæ—¶ä¿å­˜åˆ°æ—¥å¿—æ–‡ä»¶ã€‚

```bash
# è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œç›´æ¥åœ¨ç»ˆç«¯çœ‹åˆ°ï¼š
iter 0 loss 0.8234
iter 1 loss 0.7892
iter 2 loss 0.7456
...
```

**å¦‚æœè¾“å‡ºå¤ªå¤šï¼Œæƒ³åªçœ‹å…³é”®ä¿¡æ¯**ï¼š
```bash
# æ–¹æ³•1: é‡å®šå‘å¹¶è¿‡æ»¤ï¼ˆå¯åŠ¨æ—¶è®¾ç½®ï¼‰
mkdir -p logs
CUDA_VISIBLE_DEVICES=0 DISPLAY=:1 PYTHONUNBUFFERED=1 ./target/release/event_ps_train \
    --cnn-ps-train python/cnn_ps_train.py 2>&1 | \
    tee logs/train_cnn_$(date +%Y%m%d_%H%M%S).log | grep --line-buffered "iter"

# æ–¹æ³•2: å¦å¼€ç»ˆç«¯ï¼Œå®æ—¶æŸ¥çœ‹æ—¥å¿—ä¸­çš„è¿­ä»£ä¿¡æ¯
tail -f logs/train_cnn_*.log | grep --line-buffered "iter"

# æ–¹æ³•3: æŸ¥çœ‹æœ€æ–°çš„è¿­ä»£è¿›åº¦
tail -20 logs/train_cnn_*.log | grep "iter"

# æ–¹æ³•4: ç›‘æ§GPUä½¿ç”¨æƒ…å†µï¼ˆå¦å¼€ç»ˆç«¯ï¼‰
watch -n 1 nvidia-smi
```

**åœæ­¢å‰å°è®­ç»ƒ**:
```bash
# æŒ‰ Ctrl+C åœæ­¢è®­ç»ƒ
# è®­ç»ƒä¼šåœ¨ä¸‹ä¸€æ¬¡è¿­ä»£åä¼˜é›…åœæ­¢å¹¶ä¿å­˜å½“å‰æ¨¡å‹
```

#### åå°è®­ç»ƒï¼ˆé•¿æ—¶é—´æ— äººå€¼å®ˆï¼‰

```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS

# åˆ›å»ºlogsç›®å½•
mkdir -p logs

# åå°è®­ç»ƒ
nohup bash -c "source venv/bin/activate && CUDA_VISIBLE_DEVICES=0 DISPLAY=:1 PYTHONUNBUFFERED=1 \
    ./target/release/event_ps_train --cnn-ps-train python/cnn_ps_train.py" \
    > logs/train_cnn_$(date +%Y%m%d_%H%M%S).log 2>&1 &

# è®°å½•è¿›ç¨‹ID
echo $! > logs/train_cnn.pid

# å®æ—¶æŸ¥çœ‹è®­ç»ƒè¿›åº¦ï¼ˆæ¨èï¼‰
tail -f logs/train_cnn_*.log | grep --line-buffered "iter"

# æˆ–æŸ¥çœ‹æ‰€æœ‰è¾“å‡º
tail -f logs/train_cnn_*.log
```

#### CNN-PSè®­ç»ƒå‚æ•°

**é»˜è®¤å‚æ•°** (`python/cnn_ps_train.py`):
```python
# å­¦ä¹ ç‡
lr = 4e-4  # åˆå§‹å­¦ä¹ ç‡

# å­¦ä¹ ç‡è¡°å‡
milestones = [6000, 12000, 18000]  # è¡°å‡æ—¶é—´ç‚¹
gamma = 0.5  # æ¯æ¬¡è¡°å‡50%

# ä¿å­˜é¢‘ç‡
save_interval = 500  # æ¯500æ¬¡è¿­ä»£ä¿å­˜ä¸€æ¬¡

# å»ºè®®è®­ç»ƒæ¬¡æ•°
recommended_iterations = 20000  # æ¨è20000æ¬¡
```

**ä¿®æ”¹å­¦ä¹ ç‡**:
```bash
# ç¼–è¾‘è®­ç»ƒè„šæœ¬
nano python/cnn_ps_train.py

# æ‰¾åˆ°è¿™è¡Œå¹¶ä¿®æ”¹ï¼š
# OPTIMIZER = torch.optim.Adam(NET.parameters(), lr=4e-4)
```

**æ¨¡å‹ä¿å­˜ä½ç½®**:
```
data/models/
â”œâ”€â”€ ev_cnn_ps_000500.bin  # 500æ¬¡è¿­ä»£
â”œâ”€â”€ ev_cnn_ps_001000.bin  # 1000æ¬¡è¿­ä»£
â”œâ”€â”€ ev_cnn_ps_001500.bin
...
â””â”€â”€ ev_cnn_ps_020000.bin  # 20000æ¬¡è¿­ä»£
```

#### ç›‘æ§CNN-PSè®­ç»ƒ

```bash
# æŸ¥çœ‹è®­ç»ƒè¿›ç¨‹
ps aux | grep event_ps_train

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f logs/train_cnn_*.log

# æŸ¥çœ‹æœ€æ–°ä¿å­˜çš„æ¨¡å‹
ls -lht data/models/ev_cnn_ps_*.bin | head -5

# æŸ¥çœ‹GPUä½¿ç”¨æƒ…å†µ
watch -n 1 nvidia-smi

# ç»Ÿè®¡å·²è®­ç»ƒè¿­ä»£æ•°
grep "iter" logs/train_cnn_*.log | tail -1
```

#### åœæ­¢CNN-PSè®­ç»ƒ

```bash
# æ–¹æ³•1: ä¸€é”®åœæ­¢æ‰€æœ‰CNN-PSè®­ç»ƒï¼ˆæ¨èï¼‰â­
pkill -f "cnn_ps_train"

# æ–¹æ³•2: æŸ¥æ‰¾PIDåæ‰‹åŠ¨åœæ­¢
ps aux | grep "[e]vent_ps_train.*cnn_ps"
kill <PID>

# æ–¹æ³•3: å‰å°è®­ç»ƒæŒ‰ Ctrl+C
# å‰å°è®­ç»ƒæ—¶ç›´æ¥æŒ‰ Ctrl+C å³å¯ä¼˜é›…åœæ­¢
```

---

### æ–¹æ³•2: è®­ç»ƒPS-FCNæ¨¡å‹

PS-FCNæ˜¯æ›´å¤æ‚çš„å…¨å·ç§¯ç½‘ç»œï¼Œä½†è®­ç»ƒä¸å¤ªç¨³å®šã€‚

#### âš ï¸ é‡è¦æé†’

PS-FCNè®­ç»ƒå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
- ğŸš¨ **LibreDRèµ„æºæ³„æ¼**: è®­ç»ƒ3000-6000æ¬¡åå¯èƒ½å´©æºƒ
- âš ï¸ **éœ€è¦é¢„è®­ç»ƒæ¨¡å‹**: å¿…é¡»æœ‰ `PS-FCN_B_S_32.pth.tar`
- ğŸ’¡ **æ¨èä½¿ç”¨è‡ªåŠ¨æ¢å¤**: ä½¿ç”¨ `auto_train_ps_fcn.sh` è„šæœ¬

#### æ–¹æ³•2A: è‡ªåŠ¨æ¢å¤è®­ç»ƒï¼ˆå¼ºçƒˆæ¨èï¼‰â­

```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS

# ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
source venv/bin/activate

# åå°å¯åŠ¨è‡ªåŠ¨æ¢å¤è®­ç»ƒ
nohup ./auto_train_ps_fcn.sh > /dev/null 2>&1 &

# è®°å½•è¿›ç¨‹ID
echo $! > auto_train.pid
```

**ç›‘æ§è®­ç»ƒè¿›åº¦**:
```bash
# å®æ—¶æŸ¥çœ‹è¿­ä»£å’Œloss
tail -f logs/auto_train_main_*.log | grep --line-buffered "iter"

# æŸ¥çœ‹é‡å¯æ—¥å¿—
tail -f logs/auto_train_restarts_*.log

# æŸ¥çœ‹æœ€æ–°checkpoint
ls -lht data/models/ev_ps_fcn_*.bin | head -3

# æŸ¥çœ‹è®­ç»ƒè¿›ç¨‹
ps aux | grep auto_train_ps_fcn
```

**è‡ªåŠ¨æ¢å¤è„šæœ¬åŠŸèƒ½**:
- âœ… è‡ªåŠ¨ä»æœ€æ–°checkpointæ¢å¤
- âœ… å´©æºƒæ—¶è‡ªåŠ¨é‡å¯è®­ç»ƒ
- âœ… è‡ªåŠ¨æ£€æŸ¥LibreDRæœåŠ¡
- âœ… è¾¾åˆ°10000æ¬¡è‡ªåŠ¨åœæ­¢
- âœ… è¯¦ç»†æ—¥å¿—è®°å½•
- âœ… æœ€å¤šé‡å¯50æ¬¡

**åœæ­¢è‡ªåŠ¨è®­ç»ƒ** â­:
```bash
# æ–¹æ³•1: ä¸€é”®åœæ­¢ï¼ˆæ¨èï¼Œæœ€å½»åº•ï¼‰
pkill -f auto_train_ps_fcn && pkill -f event_ps_train

# æ–¹æ³•2: åªåœæ­¢è„šæœ¬ï¼ˆå­è¿›ç¨‹ä¼šè‡ªåŠ¨åœæ­¢ï¼‰
pkill -f auto_train_ps_fcn.sh

# éªŒè¯æ˜¯å¦å·²åœæ­¢
ps aux | grep -E "(event_ps_train|auto_train)" | grep -v grep
```

#### æ–¹æ³•2B: å‰å°è®­ç»ƒï¼ˆæ‰‹åŠ¨ï¼Œä»…æµ‹è¯•ç”¨ï¼‰

```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# åˆ›å»ºlogsç›®å½•
mkdir -p logs

# å‰å°è®­ç»ƒï¼ˆå¸¦GUIå’Œå®æ—¶è¾“å‡ºï¼‰
CUDA_VISIBLE_DEVICES=0 DISPLAY=:1 PYTHONUNBUFFERED=1 ./target/release/event_ps_train \
    --ps-fcn-train python/ps_fcn_train.py \
    2>&1 | tee logs/train_ps_fcn_$(date +%Y%m%d_%H%M%S).log

# âš ï¸ æ³¨æ„ï¼šå¯èƒ½åœ¨3000-6000æ¬¡å´©æºƒï¼Œéœ€è¦æ‰‹åŠ¨é‡å¯
```**æŸ¥çœ‹è¿­ä»£å’Œlossï¼ˆPS-FCNå‰å°è®­ç»ƒï¼‰** â­:

å‰å°è®­ç»ƒæ—¶ï¼Œè¾“å‡ºä¼šå®æ—¶æ˜¾ç¤ºåœ¨ç»ˆç«¯ï¼š

```bash
# è®­ç»ƒè¿‡ç¨‹ä¸­çœ‹åˆ°ï¼š
iter 0 loss torch.Size([1, 128, 128]) loss_mean 0.7234
iter 1 loss torch.Size([1, 128, 128]) loss_mean 0.6892
iter 2 loss torch.Size([1, 128, 128]) loss_mean 0.6543
...
```

**åªçœ‹å…³é”®ä¿¡æ¯**ï¼š
```bash
# æ–¹æ³•1: å¯åŠ¨æ—¶è¿‡æ»¤ï¼ˆæ¨èï¼‰
mkdir -p logs
CUDA_VISIBLE_DEVICES=0 DISPLAY=:1 PYTHONUNBUFFERED=1 ./target/release/event_ps_train \
    --ps-fcn-train python/ps_fcn_train.py 2>&1 | \
    tee logs/train_ps_fcn_$(date +%Y%m%d_%H%M%S).log | grep --line-buffered "loss_mean"

# æ–¹æ³•2: å¦å¼€ç»ˆç«¯æŸ¥çœ‹
tail -f logs/train_ps_fcn_*.log | grep --line-buffered "iter"

# æ–¹æ³•3: æŸ¥çœ‹æœ€æ–°è¿›åº¦
tail -20 logs/train_ps_fcn_*.log | grep "iter"
```

#### æ–¹æ³•2C: åå°è®­ç»ƒï¼ˆæ‰‹åŠ¨ï¼Œä¸æ¨èï¼‰

```bash
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS

# åˆ›å»ºlogsç›®å½•
mkdir -p logs

# åå°è®­ç»ƒ
nohup bash -c "source venv/bin/activate && CUDA_VISIBLE_DEVICES=0 DISPLAY=:1 PYTHONUNBUFFERED=1 \
    ./target/release/event_ps_train --ps-fcn-train python/ps_fcn_train.py" \
    > logs/train_ps_fcn_$(date +%Y%m%d_%H%M%S).log 2>&1 &

echo $! > logs/train_ps_fcn.pid

# âš ï¸ æ³¨æ„ï¼šå¯èƒ½å´©æºƒï¼Œéœ€è¦ç›‘æ§å¹¶æ‰‹åŠ¨é‡å¯
```

#### PS-FCNè®­ç»ƒå‚æ•°

**é»˜è®¤å‚æ•°** (`python/ps_fcn_train.py`):
```python
# å¤šå±‚å­¦ä¹ ç‡ï¼ˆä¸åŒå±‚ä½¿ç”¨ä¸åŒå­¦ä¹ ç‡ï¼‰
lr_conv_time = 1e-4    # æ—¶é—´å·ç§¯å±‚
lr_conv1 = 1e-4        # ç¬¬ä¸€å·ç§¯å±‚
lr_conv2 = 1e-4        # ç¬¬äºŒå·ç§¯å±‚
lr_extractor = 1e-5    # ç‰¹å¾æå–å™¨
lr_regressor = 1e-6    # å›å½’å™¨

# å­¦ä¹ ç‡è¡°å‡
milestones = [3000, 6000, 9000]  # è¡°å‡æ—¶é—´ç‚¹
gamma = 0.5  # æ¯æ¬¡è¡°å‡50%

# ä¿å­˜é¢‘ç‡
save_interval = 3000  # æ¯3000æ¬¡è¿­ä»£ä¿å­˜ä¸€æ¬¡

# æœ€å¤§è®­ç»ƒæ¬¡æ•°
MAX_ITERATIONS = 10000
```

**ä¿®æ”¹å­¦ä¹ ç‡**:
```bash
# ç¼–è¾‘è®­ç»ƒè„šæœ¬
nano python/ps_fcn_train.py

# æ‰¾åˆ°è¿™éƒ¨åˆ†å¹¶ä¿®æ”¹ï¼š
params = [
    {"params": NET.conv_time.parameters(), "lr": 1e-4},
    {"params": NET.extractor.conv1.parameters(), "lr": 1e-4},
    {"params": NET.extractor.conv2.parameters(), "lr": 1e-4},
    {"params": extractor_params, "lr": 1e-5},
    {"params": NET.regressor.parameters(), "lr": 1e-6},
]
```

**æ¨¡å‹ä¿å­˜ä½ç½®**:
```
data/models/
â”œâ”€â”€ ev_ps_fcn_003000.bin  # 3000æ¬¡è¿­ä»£
â”œâ”€â”€ ev_ps_fcn_006000.bin  # 6000æ¬¡è¿­ä»£
â”œâ”€â”€ ev_ps_fcn_009000.bin  # 9000æ¬¡è¿­ä»£
â””â”€â”€ ev_ps_fcn_010000.bin  # 10000æ¬¡è¿­ä»£ï¼ˆå®Œæˆï¼‰
```

#### ç›‘æ§PS-FCNè®­ç»ƒ

```bash
# æŸ¥çœ‹è®­ç»ƒè¿›ç¨‹
ps aux | grep event_ps_train

# å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼ˆè‡ªåŠ¨æ¢å¤æ¨¡å¼ï¼‰
tail -f logs/auto_train_main_*.log | grep --line-buffered "iter"

# å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼ˆæ‰‹åŠ¨æ¨¡å¼ï¼‰
tail -f logs/train_ps_fcn_*.log

# æŸ¥çœ‹æœ€æ–°ä¿å­˜çš„æ¨¡å‹
ls -lht data/models/ev_ps_fcn_*.bin | head -5

# æŸ¥çœ‹GPUä½¿ç”¨æƒ…å†µ
watch -n 1 nvidia-smi

# æŸ¥çœ‹è®­ç»ƒé‡å¯æ¬¡æ•°ï¼ˆè‡ªåŠ¨æ¢å¤æ¨¡å¼ï¼‰
grep "Attempt" logs/auto_train_restarts_*.log | wc -l
```

---

### è®­ç»ƒå®Œæ•´æµç¨‹æ€»ç»“

#### å®Œæ•´CNN-PSè®­ç»ƒæµç¨‹ï¼ˆæ¨èï¼‰â­

```bash
# Step 1: ç¯å¢ƒå‡†å¤‡
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# Step 2: ç¡®è®¤LibreDRæœåŠ¡
ps aux | grep libredr

# Step 3: ç¡®è®¤è®­ç»ƒæ•°æ®
ls -d data/blobs_training/*/ | wc -l
ls -d data/sculptures_training/*/ | wc -l

# Step 4: å¯åŠ¨è®­ç»ƒï¼ˆåå°ï¼‰
mkdir -p logs
nohup bash -c "source venv/bin/activate && CUDA_VISIBLE_DEVICES=0 DISPLAY=:1 PYTHONUNBUFFERED=1 \
    ./target/release/event_ps_train --cnn-ps-train python/cnn_ps_train.py" \
    > logs/train_cnn_$(date +%Y%m%d_%H%M%S).log 2>&1 &

echo $! > logs/train_cnn.pid

# Step 5: å®æ—¶ç›‘æ§è®­ç»ƒè¿›åº¦
# æ–¹æ³•1: åªçœ‹è¿­ä»£å’Œlossï¼ˆæ¨èï¼‰
tail -f logs/train_cnn_*.log | grep --line-buffered "iter"

# æ–¹æ³•2: æŸ¥çœ‹æ‰€æœ‰è¾“å‡º
tail -f logs/train_cnn_*.log

# æ–¹æ³•3: ç›‘æ§GPUä½¿ç”¨
watch -n 1 nvidia-smi

# æ–¹æ³•4: æŸ¥çœ‹æœ€æ–°10æ¬¡è¿­ä»£
watch -n 2 "tail -20 logs/train_cnn_*.log | grep iter | tail -10"

# Step 6: ç­‰å¾…å®Œæˆï¼ˆå»ºè®®è®­ç»ƒåˆ°20000æ¬¡ï¼‰
# é¢„è®¡æ—¶é—´: æ ¹æ®GPUæ€§èƒ½ï¼Œå¯èƒ½éœ€è¦æ•°å°æ—¶åˆ°æ•°å¤©
# è®­ç»ƒè¾“å‡ºç¤ºä¾‹ï¼š
# iter 0 loss 0.8234
# iter 1 loss 0.7892
# iter 500 loss 0.3456  â† è‡ªåŠ¨ä¿å­˜æ¨¡å‹
# iter 1000 loss 0.2987

# Step 7: è®­ç»ƒå®Œæˆåï¼Œè¯„ä¼°æ¨¡å‹
./target/release/event_ps_eval_python_gui data/diligent/000000/eval_cnn_ps.ini
```

#### å®Œæ•´PS-FCNè®­ç»ƒæµç¨‹

```bash
# Step 1: ç¯å¢ƒå‡†å¤‡
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# Step 2: ç¡®è®¤é¢„è®­ç»ƒæ¨¡å‹å­˜åœ¨
ls -lh python/ev_ps_fcn/PS-FCN/data/models/PS-FCN_B_S_32.pth.tar

# Step 3: ç¡®è®¤LibreDRæœåŠ¡å’Œè®­ç»ƒæ•°æ®
ps aux | grep libredr
ls -d data/blobs_training/*/ | wc -l

# Step 4: å¯åŠ¨è‡ªåŠ¨æ¢å¤è®­ç»ƒ
nohup ./auto_train_ps_fcn.sh > /dev/null 2>&1 &
echo $! > auto_train.pid

# Step 5: å®æ—¶ç›‘æ§è®­ç»ƒè¿›åº¦
# æ–¹æ³•1: åªçœ‹è¿­ä»£å’Œlossï¼ˆæ¨èï¼‰
tail -f logs/auto_train_main_*.log | grep --line-buffered "iter"

# æ–¹æ³•2: æŸ¥çœ‹åŒ…å«loss_meançš„è¡Œ
tail -f logs/auto_train_main_*.log | grep "iter.*loss_mean"

# æ–¹æ³•3: æŸ¥çœ‹æ‰€æœ‰è®­ç»ƒè¾“å‡º
tail -f logs/auto_train_main_*.log

# æ–¹æ³•4: æŸ¥çœ‹æœ€æ–°10æ¬¡è¿­ä»£
watch -n 2 "tail -50 logs/auto_train_main_*.log | grep iter | tail -10"

# æ–¹æ³•5: æŸ¥çœ‹é‡å¯æƒ…å†µ
tail -f logs/auto_train_restarts_*.log

# æ–¹æ³•6: ç›‘æ§GPUä½¿ç”¨
watch -n 1 nvidia-smi

# Step 6: ç­‰å¾…å®Œæˆï¼ˆè‡ªåŠ¨è®­ç»ƒåˆ°10000æ¬¡ï¼‰
# é¢„è®¡æ—¶é—´: æ ¹æ®GPUæ€§èƒ½å’Œå´©æºƒé¢‘ç‡ï¼Œå¯èƒ½éœ€è¦æ•°å¤©
# è®­ç»ƒè¾“å‡ºç¤ºä¾‹ï¼š
# iter 0 loss_mean 0.7234
# iter 1 loss_mean 0.6892
# iter 3000 loss_mean 0.3456  â† è‡ªåŠ¨ä¿å­˜æ¨¡å‹
# [å¯èƒ½å´©æºƒå¹¶è‡ªåŠ¨é‡å¯]
# iter 3001 loss_mean 0.3445  â† ä»checkpointæ¢å¤

# Step 7: è®­ç»ƒå®Œæˆåï¼Œè¯„ä¼°æ¨¡å‹
# å…ˆä¿®æ”¹è¯„ä¼°è„šæœ¬åŠ è½½æœ€æ–°æ¨¡å‹
nano python/ps_fcn_eval.py
# ç„¶åè¿è¡Œè¯„ä¼°
./target/release/event_ps_eval_python_gui data/diligent/000000/eval_ps_fcn.ini
```

---

## å¸¸è§é—®é¢˜

### æ„å»ºå’Œç¼–è¯‘ç›¸å…³

#### Q1: ç¼–è¯‘æ—¶å‡ºç° "linker error" æˆ–æ‰¾ä¸åˆ°OpenCV
**åŸå› **: ç¼ºå°‘ç³»ç»Ÿä¾èµ–

**è§£å†³æ–¹æ¡ˆ**:
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install -y libopencv-dev clang libclang-dev pkg-config

# é‡æ–°ç¼–è¯‘
cargo clean
cargo build --release --features loader_render
```

#### Q2: ç¼–è¯‘æ—¶å‡ºç° Rust ç‰ˆæœ¬è¿‡ä½
**åŸå› **: Rustç‰ˆæœ¬ä¸å…¼å®¹

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ›´æ–°Ruståˆ°æœ€æ–°ç¨³å®šç‰ˆ
rustup update stable
rustup default stable

# éªŒè¯ç‰ˆæœ¬
rustc --version
```

#### Q3: Pythonä¾èµ–å®‰è£…å¤±è´¥
**åŸå› **: pipç‰ˆæœ¬è¿‡æ—§æˆ–ç¼ºå°‘ç³»ç»Ÿåº“

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ›´æ–°pip
pip install --upgrade pip setuptools wheel

# å®‰è£…CUDAç›¸å…³ä¾èµ–ï¼ˆå¦‚æœä½¿ç”¨GPUï¼‰
pip install torch torchvision --index-url https://download.pytorch.org/whl/cu118

# å®‰è£…å…¶ä»–ä¾èµ–
pip install -r python/requirements.txt
```

---

### æ•°æ®å‡†å¤‡ç›¸å…³

#### Q4: DiLiGenTæ•°æ®é›†è½¬æ¢å¤±è´¥
**åŸå› **: ç¼ºå°‘DiLiGenT.zipæˆ–LibreDRæœªè¿è¡Œ

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥zipæ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -lh data/DiLiGenT.zip

# æ£€æŸ¥LibreDRæœåŠ¡
ps aux | grep libredr

# å¦‚æœLibreDRæœªè¿è¡Œï¼Œå¯åŠ¨å®ƒ
cd /home/c303/cxz/LibreDR
nohup ./libredr_server > libredr_server.log 2>&1 &
nohup ./libredr_worker > libredr_worker.log 2>&1 &
```

#### Q5: LibreDRæœåŠ¡å™¨æ— æ³•è¿æ¥
**åŸå› **: æœåŠ¡å™¨æœªå¯åŠ¨æˆ–ç«¯å£å ç”¨

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥LibreDRè¿›ç¨‹
ps aux | grep libredr

# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -tulpn | grep libredr

# é‡å¯LibreDRæœåŠ¡
pkill libredr_server
pkill libredr_worker
cd /home/c303/cxz/LibreDR
nohup ./libredr_server > libredr_server.log 2>&1 &
nohup ./libredr_worker > libredr_worker.log 2>&1 &
```

#### Q6: æ¸²æŸ“æ•°æ®ç”Ÿæˆéå¸¸æ…¢
**åŸå› **: æ­£å¸¸ç°è±¡ï¼Œæ¸²æŸ“éœ€è¦å¤§é‡GPUè®¡ç®—

**å»ºè®®**:
- åå°è¿è¡Œæ¸²æŸ“è„šæœ¬: `nohup bash ./scripts/render.sh > render.log 2>&1 &`
- ç›‘æ§GPUä½¿ç”¨: `watch -n 1 nvidia-smi`
- é¢„è®¡æ—¶é—´: æ ¹æ®GPUæ€§èƒ½ï¼Œå¯èƒ½éœ€è¦æ•°å°æ—¶åˆ°æ•°å¤©
- ç¡®ä¿æœ‰è¶³å¤Ÿç£ç›˜ç©ºé—´: `df -h`

#### Q7: æ‰¾ä¸åˆ°PS-FCNé¢„è®­ç»ƒæ¨¡å‹
**åŸå› **: æœªä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ‰‹åŠ¨ä¸‹è½½
# 1. è®¿é—® https://github.com/guanyingc/PS-FCN
# 2. ä¸‹è½½ PS-FCN_B_S_32.pth.tar
# 3. æ”¾ç½®åˆ°æ­£ç¡®ä½ç½®
mkdir -p python/ev_ps_fcn/PS-FCN/data/models/
mv ~/Downloads/PS-FCN_B_S_32.pth.tar python/ev_ps_fcn/PS-FCN/data/models/

# éªŒè¯
ls -lh python/ev_ps_fcn/PS-FCN/data/models/PS-FCN_B_S_32.pth.tar
```

---

### è¿è¡Œå’Œæ˜¾ç¤ºç›¸å…³

#### Q8: æ®µé”™è¯¯ (Segmentation Fault)
**åŸå› **: Rustç«¯å’ŒPythonç«¯åŒæ—¶ä½¿ç”¨OpenCV GUIå¯¼è‡´å†²çª

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨Python GUIæ—¶ï¼Œç¡®ä¿ `show_ls_ps = none`
- ä½¿ç”¨Rust GUIæ—¶ï¼Œç¦ç”¨Pythonä»£ç ä¸­çš„ `cv.imshow()`

#### Q9: ModuleNotFoundError: No module named 'torch'
**åŸå› **: æœªæ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

**è§£å†³æ–¹æ¡ˆ**:
```bash
source venv/bin/activate
```

#### Q10: GUIçª—å£ä¸æ˜¾ç¤º
**æ£€æŸ¥é¡¹**:
1. ç¡®è®¤DISPLAYç¯å¢ƒå˜é‡: `echo $DISPLAY`
2. ç¡®è®¤X serveræ­£åœ¨è¿è¡Œ
3. ç¡®è®¤ä½¿ç”¨äº†æ­£ç¡®çš„å¯æ‰§è¡Œæ–‡ä»¶ç‰ˆæœ¬
4. æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯æ—¥å¿—

#### Q11: è¯„ä¼°é€Ÿåº¦æ…¢
**ä¼˜åŒ–å»ºè®®**:
- ä½¿ç”¨GPU: ç¡®è®¤CUDAå¯ç”¨ `nvidia-smi`
- å‡å°‘batch size (å¦‚æœå†…å­˜ä¸è¶³)
- å…³é—­GUIæ˜¾ç¤ºå¯æå‡é€Ÿåº¦

---

### è®­ç»ƒç›¸å…³

#### Q12: PS-FCNè®­ç»ƒæ€»æ˜¯å´©æºƒæ€ä¹ˆåŠï¼Ÿ
**åŸå› **: LibreDRæ¸²æŸ“æœåŠ¡å™¨GPUèµ„æºæ³„æ¼ï¼Œå¯¼è‡´å†…å­˜é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨è‡ªåŠ¨æ¢å¤è®­ç»ƒè„šæœ¬ï¼ˆå¼ºçƒˆæ¨èï¼‰
```bash
# å¯åŠ¨è‡ªåŠ¨æ¢å¤è®­ç»ƒ
nohup ./auto_train_ps_fcn.sh > /dev/null 2>&1 &

# ç›‘æ§è¿›åº¦
tail -f logs/auto_train_main_*.log | grep "iter"
```

è„šæœ¬ä¼šè‡ªåŠ¨å¤„ç†å´©æºƒå¹¶ä»checkpointæ¢å¤ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚

#### Q13: å¦‚ä½•æŸ¥çœ‹å½“å‰è®­ç»ƒè¿›åº¦ï¼Ÿ
```bash
# æ–¹æ³•1: æŸ¥çœ‹æœ€æ–°checkpoint
ls -lht data/models/ev_*_*.bin | head -5

# æ–¹æ³•2: æŸ¥çœ‹æ—¥å¿—æœ€åå‡ è¡Œ
tail -20 logs/train_*.log

# æ–¹æ³•3: å®æ—¶ç›‘æ§è¿­ä»£å’Œlossï¼ˆCNN-PSï¼‰
tail -f logs/train_cnn_*.log | grep --line-buffered "iter"

# æ–¹æ³•4: å®æ—¶ç›‘æ§è¿­ä»£å’Œlossï¼ˆPS-FCNè‡ªåŠ¨æ¢å¤ï¼‰
tail -f logs/auto_train_main_*.log | grep --line-buffered "iter"
```

#### Q14: è®­ç»ƒè¿‡ç¨‹ä¸­GPUå†…å­˜æº¢å‡º (CUDA out of memory)
**åŸå› **: batch sizeå¤ªå¤§æˆ–GPUæ˜¾å­˜ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥GPUä½¿ç”¨æƒ…å†µ
nvidia-smi

# å‡å°batch sizeï¼ˆç¼–è¾‘è®­ç»ƒè„šæœ¬ï¼‰
nano python/cnn_ps_train.py  # æˆ– ps_fcn_train.py

# æ¸…ç†GPUç¼“å­˜åé‡è¯•
# åœ¨è®­ç»ƒè„šæœ¬ä¸­æ·»åŠ ï¼š
torch.cuda.empty_cache()
```

#### Q15: å¦‚ä½•ä»checkpointæ¢å¤è®­ç»ƒï¼Ÿ
**CNN-PSæ‰‹åŠ¨æ¢å¤**:
```bash
# ç¼–è¾‘è®­ç»ƒè„šæœ¬ python/cnn_ps_train.py
# å–æ¶ˆæ³¨é‡ŠcheckpointåŠ è½½ä»£ç ï¼š
checkpoint = torch.load("data/models/ev_cnn_ps_019500.bin")
NET.load_state_dict(checkpoint["model_state_dict"])
OPTIMIZER.load_state_dict(checkpoint["optimizer_state_dict"])
```

**PS-FCNè‡ªåŠ¨æ¢å¤**: ä½¿ç”¨ `auto_train_ps_fcn.sh` è„šæœ¬ä¼šè‡ªåŠ¨ä»æœ€æ–°checkpointæ¢å¤

---

### è¯„ä¼°ç›¸å…³

#### Q16: å¦‚ä½•åˆ‡æ¢è¯„ä¼°çš„æ¨¡å‹ï¼Ÿ
**CNN-PSæ¨¡å‹**:
```bash
# ç¼–è¾‘è¯„ä¼°è„šæœ¬ python/cnn_ps_eval.py
nano python/cnn_ps_eval.py

# ä¿®æ”¹æ¨¡å‹è·¯å¾„ï¼ˆçº¦ç¬¬87è¡Œï¼‰
NET.load_state_dict(torch.load("data/models/ev_cnn_ps_020000.bin")["model_state_dict"])
```

**PS-FCNæ¨¡å‹**:
```bash
# ç¼–è¾‘è¯„ä¼°è„šæœ¬ python/ps_fcn_eval.py
nano python/ps_fcn_eval.py

# ä¿®æ”¹æ¨¡å‹è·¯å¾„ï¼ˆçº¦ç¬¬78è¡Œï¼‰
NET.load_state_dict(torch.load("data/models/ev_ps_fcn_010000.bin")["model_state_dict"])
```

#### Q17: è¯„ä¼°ç»“æœä¿å­˜åœ¨å“ªé‡Œï¼Ÿ
```bash
# ç»ˆç«¯è¾“å‡ºï¼ˆå®æ—¶ï¼‰
BENCHMARK Event-LS-PS n_pixels 33785 ang_err_mean 10.99
BENCHMARK Event-CNN-PS n_pixels 33785 ang_err_mean 10.16

# å¦‚æœä½¿ç”¨å®˜æ–¹è¯„ä¼°è„šæœ¬
# ç»“æœä¿å­˜åœ¨: data/diligent/*/result.txt

# ç”Ÿæˆå®Œæ•´è¯„ä¼°æŠ¥å‘Š
python3 generate_evaluation_report.py
# è¾“å‡º: evaluation_results_diligent.csv, .txt, .png
```

#### Q18: å¦‚ä½•æ‰¹é‡è¯„ä¼°æ‰€æœ‰æ•°æ®é›†ï¼Ÿ
```bash
# CNN-PSæ‰¹é‡è¯„ä¼°
for dir in data/diligent/*/; do
    echo "è¯„ä¼° $dir"
    ./target/release/event_ps_eval_python_gui ${dir}eval_cnn_ps.ini
done

# PS-FCNæ‰¹é‡è¯„ä¼°
for dir in data/diligent/*/; do
    echo "è¯„ä¼° $dir"
    ./target/release/event_ps_eval_python_gui ${dir}eval_ps_fcn.ini
done

# ä½¿ç”¨å®˜æ–¹è„šæœ¬ï¼ˆä¿å­˜ç»“æœåˆ°æ–‡ä»¶ï¼‰
bash ./scripts/diligent_eval.sh
```

---

## è¯„ä¼°ç»“æœ

### DiLiGenTæ•°æ®é›†è¯„ä¼°ç»“æœï¼ˆev_cnn_ps_019500.binï¼‰

| Dataset ID | åç§° | Pixels | LS-PSè¯¯å·® | CNN-PSè¯¯å·® | æå‡å¹…åº¦ |
|-----------|------|--------|----------|-----------|---------|
| 000000 | Ball | 33785 | 10.99Â° | **10.16Â°** | 7.52% â†‘ |
| 000002 | Bear | 21589 | 18.73Â° | **16.45Â°** | 12.14% â†‘ |
| 000003 | Buddha | 27776 | 12.74Â° | **11.67Â°** | 8.39% â†‘ |
| 000004 | Cat | 28656 | 26.51Â° | **17.32Â°** | 34.68% â†‘ â­ |
| 000005 | Cow | 12330 | 18.43Â° | **15.31Â°** | 16.91% â†‘ |
| 000006 | Goblet | 22656 | 36.06Â° | **23.76Â°** | 34.12% â†‘ â­ |
| 000007 | Harvest | 18817 | 13.78Â° | **12.45Â°** | 9.61% â†‘ |
| 000008 | Pot1 | 22086 | 15.75Â° | **14.49Â°** | 7.98% â†‘ |
| 000009 | Pot2 | 28942 | 24.61Â° | **19.08Â°** | 22.47% â†‘ |
| **å¹³å‡** | - | - | **19.73Â°** | **15.63Â°** | **20.78%** â†‘ |

### å…³é”®å‘ç°
- âœ¨ **å¹³å‡æå‡20.78%**: CNNæ¨¡å‹æ˜¾è‘—ä¼˜äºç»å…¸LS-PSæ–¹æ³•
- ğŸ† **æœ€ä½³è¡¨ç°**: Catå’ŒGobletæ•°æ®é›†æå‡è¶…è¿‡34%
- ğŸ“Š **ç¨³å®šæ€§**: åœ¨æ‰€æœ‰9ä¸ªæ•°æ®é›†ä¸Šå‡æœ‰æ”¹å–„
- ğŸ¯ **è¯¯å·®èŒƒå›´**: CNN-PSè¯¯å·®ä»10.16Â°åˆ°23.76Â°

### å¯è§†åŒ–ç»“æœ
æŸ¥çœ‹ä»¥ä¸‹å›¾è¡¨äº†è§£è¯¦ç»†å¯¹æ¯”ï¼š
- `evaluation_results_diligent.png` - 4åˆ1ç»¼åˆåˆ†æ
- `evaluation_comparison_simple.png` - ç®€æ´æŸ±çŠ¶å›¾å¯¹æ¯”

---

## é™„å½•

### æ–‡ä»¶è¯´æ˜

**é…ç½®æ–‡ä»¶**:
- `data/diligent/*/eval_cnn_ps.ini` - è¯„ä¼°é…ç½®
- `data/diligent/*/render.ini` - æ¸²æŸ“é…ç½®

**æ•°æ®æ–‡ä»¶**:
- `data/diligent/*/event_internal.xz` - äº‹ä»¶æ•°æ®
- `data/diligent/*/normal.xz` - Ground Truthæ³•çº¿
- `data/diligent/*/frames/*.png` - æ¸²æŸ“å¸§

**æ¨¡å‹æ–‡ä»¶**:
- `data/models/ev_cnn_ps_019500.bin` - æœ€æ–°è®­ç»ƒæ¨¡å‹
- `data/models/ev_cnn_ps.bin` - å®˜æ–¹é¢„è®­ç»ƒæ¨¡å‹

### å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# === ç¯å¢ƒå‡†å¤‡ ===
cd /home/c303/cxz/EventPSï¼ˆGUIï¼‰/EventPS
source venv/bin/activate

# === è¯„ä¼°æ“ä½œ ===
# å•ä¸ªè¯„ä¼°ï¼ˆPython GUIï¼‰
./target/release/event_ps_eval_python_gui data/diligent/000000/eval_cnn_ps.ini

# æ‰¹é‡è¯„ä¼°
for dir in data/diligent/*/; do ./target/release/event_ps_eval_python_gui ${dir}eval_cnn_ps.ini; done

# === è®­ç»ƒæ“ä½œ ===
# å‰å°è®­ç»ƒ
./target/release/event_ps_train --cnn-ps-train python/cnn_ps_train.py

# åå°è®­ç»ƒ
nohup ./target/release/event_ps_train --cnn-ps-train python/cnn_ps_train.py > train.log 2>&1 &

# === æŸ¥çœ‹è¿›ç¨‹ ===
ps aux | grep event_ps

# === ç”ŸæˆæŠ¥å‘Š ===
python3 generate_evaluation_report.py
```

---

## å¿«é€Ÿå¼€å§‹æŒ‡å—ï¼ˆæ–°æ‰‹ï¼‰

å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨EventPSï¼ŒæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

### Step 1: å…‹éš†é¡¹ç›®ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
```bash
# ä½¿ç”¨Git LFSå…‹éš†ï¼ˆåŒ…å«æ•°æ®ï¼‰
git lfs install
git clone --recursive https://codeberg.org/ybh1998/EventPS.git

# æˆ–åªå…‹éš†ä»£ç ï¼ˆä¸åŒ…å«æ•°æ®ï¼‰
GIT_LFS_SKIP_SMUDGE=1 git clone --recursive https://codeberg.org/ybh1998/EventPS.git
```

### Step 2: å®‰è£…ä¾èµ–
```bash
cd EventPS

# å®‰è£…Rustï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source $HOME/.cargo/env

# å®‰è£…ç³»ç»Ÿä¾èµ–
sudo apt-get update
sudo apt-get install -y libopencv-dev clang libclang-dev pkg-config

# åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate
pip install -r python/requirements.txt
```

### Step 3: ç¼–è¯‘é¡¹ç›®
```bash
# ç¼–è¯‘ï¼ˆåŒ…å«æ¸²æŸ“åŠŸèƒ½ï¼‰
cargo build --release --features loader_render
```

### Step 4: å‡†å¤‡æ•°æ®ï¼ˆè¯„ä¼°ï¼‰
```bash
# ä¸‹è½½DiLiGenTæ•°æ®é›†åˆ° data/DiLiGenT.zip
# ç„¶åè½¬æ¢æ•°æ®
bash ./scripts/diligent_convert.sh
```

### Step 5: è¯„ä¼°é¢„è®­ç»ƒæ¨¡å‹
```bash
source venv/bin/activate
./target/release/event_ps_eval_python_gui data/diligent/000000/eval_cnn_ps.ini
```

### Step 6: è®­ç»ƒæ–°æ¨¡å‹ï¼ˆå¯é€‰ï¼‰
```bash
# å‡†å¤‡è®­ç»ƒæ•°æ®ï¼ˆéœ€è¦LibreDRæœåŠ¡ï¼‰
bash ./scripts/render.sh

# è®­ç»ƒCNN-PSæ¨¡å‹
./target/release/event_ps_train --cnn-ps-train python/cnn_ps_train.py
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**æ›´æ–°æ—¥æœŸ**: 2025-10-23  
**æ¨¡å‹ç‰ˆæœ¬**: ev_cnn_ps_019500.bin  
**ä½œè€…**: EventPS Team  
**é¡¹ç›®ä¸»é¡µ**: [EventPS](https://www.ybh1998.space/eventps-real-time-photometric-stereo-using-an-event-camera/)  
**ä»£ç ä»“åº“**: [Codeberg](https://codeberg.org/ybh1998/EventPS/)  
**è®ºæ–‡**: Yu et al., "EventPS: Real-Time Photometric Stereo Using an Event Camera", CVPR 2024


